<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SMC Prop Engine v3</title>
<link rel="stylesheet" href="css/styles.css">
</head>
<body>

<!-- â”€â”€ HEADER â”€â”€ -->
<header id="app-header">
  <div class="header-brand">
    <div class="brand-logo">S</div>
    <div>
      <div class="brand-name">SMC PROP ENGINE</div>
      <div class="brand-tag">SPOT ONLY Â· ICT SMC Â· v3.0</div>
    </div>
  </div>
  <nav class="nav-tabs">
    <button class="nav-tab active" data-view="live">âš¡ Live</button>
    <button class="nav-tab" data-view="backtest">ğŸ“Š Backtest</button>
    <button class="nav-tab" data-view="analytics">ğŸ“ˆ Analytics</button>
    <button class="nav-tab" data-view="trades">ğŸ“ Journal</button>
    <button class="nav-tab" data-view="settings">âš™ï¸ Settings</button>
  </nav>
  <div class="header-status">
    <div class="status-dot"></div>
    <span style="font-size:10px;color:var(--text-2)">LIVE</span>
    <span style="color:var(--text-3)">|</span>
    <select id="symbol-select" style="background:transparent;border:1px solid var(--border);color:var(--text-0);font-family:inherit;font-size:11px;padding:3px 6px;border-radius:4px;cursor:pointer;outline:none;">
      <option>BTCUSDT</option><option>ETHUSDT</option><option>SOLUSDT</option>
      <option>BNBUSDT</option><option>XRPUSDT</option><option>ADAUSDT</option>
    </select>
    <span id="header-price" style="color:var(--accent-gold);font-size:11px;font-weight:600">--</span>
    <span style="color:var(--text-3)">|</span>
    <span class="header-equity" id="header-equity">$10,000</span>
    <span style="color:var(--text-3)">|</span>
    <span id="scan-status" style="font-size:9px;color:var(--text-3);max-width:240px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">Initializing...</span>
  </div>
</header>

<!-- â”€â”€ MAIN â”€â”€ -->
<div id="app-main">

  <!-- SIDEBAR LEFT -->
  <aside id="sidebar-left">
    <div class="sidebar-section">
      <div class="sidebar-label">Aligned Bias</div>
      <div class="bias-card" style="border-color:rgba(0,212,255,0.2)">
        <div class="bias-tf">HTF CONFLUENCE</div>
        <div class="bias-val neutral" id="aligned-bias">â—† NEUTRAL</div>
      </div>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-label">Timeframe Bias</div>
      <div id="bias-container">
        <div class="bias-card"><div class="bias-tf">15m</div><div class="bias-val neutral">â—† SCANNING</div></div>
        <div class="bias-card"><div class="bias-tf">1H</div><div class="bias-val neutral">â—† SCANNING</div></div>
        <div class="bias-card"><div class="bias-tf">4H</div><div class="bias-val neutral">â—† SCANNING</div></div>
      </div>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-label">Session</div>
      <div id="session-display"><div class="session-badge off">â¸ Loading...</div></div>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-label">Liquidity Map</div>
      <div id="liquidity-container"><div style="font-size:9px;color:var(--text-3);text-align:center;padding:12px">Scanning...</div></div>
    </div>
    <div class="sidebar-section" style="border-bottom:none">
      <div class="sidebar-label">Strategies</div>
      <div id="strategy-toggles"></div>
    </div>
  </aside>

  <!-- MAIN PANEL -->
  <main id="main-panel">

    <!-- â•â•â• LIVE â•â•â• -->
    <div class="view-panel active" id="view-live">
      <div class="stats-bar">
        <div class="stat-card cyan"><div class="stat-label">Equity</div><div class="stat-value" id="stat-equity">$10,000</div><div class="stat-sub">Balance</div></div>
        <div class="stat-card green"><div class="stat-label">Win Rate</div><div class="stat-value green" id="stat-wr">--%</div><div class="stat-sub">Closed</div></div>
        <div class="stat-card blue"><div class="stat-label">Trades</div><div class="stat-value" id="stat-trades">0</div><div class="stat-sub">Total</div></div>
        <div class="stat-card red"><div class="stat-label">Drawdown</div><div class="stat-value red" id="stat-dd">0.00%</div><div class="stat-sub">Current</div></div>
        <div class="stat-card purple"><div class="stat-label">Session</div><div class="stat-value" id="stat-session" style="font-size:13px">--</div><div class="stat-sub">Active</div></div>
        <div class="stat-card gold"><div class="stat-label">Signals</div><div class="stat-value gold" id="stat-signals">0</div><div class="stat-sub">Live</div></div>
      </div>

      <div class="chart-container" id="main-canvas-container" style="min-height:300px">
        <div class="chart-header">
          <div class="chart-symbol">
            <span id="chart-symbol-name">BTCUSDT</span>
            <span style="font-size:10px;color:var(--accent-green);margin-left:6px" id="chart-live-price"></span>
          </div>
          <div class="tf-buttons">
            <button class="tf-btn active" data-tf="15m">15m</button>
            <button class="tf-btn" data-tf="1H">1H</button>
            <button class="tf-btn" data-tf="4H">4H</button>
          </div>
        </div>
        <canvas id="main-canvas"></canvas>
      </div>

      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;flex-wrap:wrap;gap:6px">
        <div style="font-family:'Syne',sans-serif;font-size:12px;font-weight:700;letter-spacing:0.08em;color:var(--text-1);text-transform:uppercase">Live Signals</div>
        <div style="display:flex;gap:6px;align-items:center">
          <span style="font-size:8px;color:var(--text-3)">ALL SPOT USDT PAIRS Â· EVERY 15 MIN</span>
          <button onclick="openAddTradeModal(null)" class="btn-secondary" style="padding:4px 10px;font-size:10px;color:var(--accent-green);border-color:rgba(0,232,122,0.3)">â• Add Trade</button>
        </div>
      </div>
      <div class="signals-grid" id="signals-container">
        <div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">â³</div><p>Scanning all Binance spot USDT pairs...</p></div>
      </div>
    </div>

    <!-- â•â•â• BACKTEST â•â•â• -->
    <div class="view-panel" id="view-backtest">
      <div style="font-family:'Syne',sans-serif;font-size:16px;font-weight:800;color:var(--text-0);margin-bottom:14px">ğŸ“Š Backtest Engine â€” Spot Trading Only</div>

      <div class="backtest-controls">
        <div class="ctrl-group">
          <label>Symbol</label>
          <select id="bt-symbol">
            <option>BTCUSDT</option><option>ETHUSDT</option><option>SOLUSDT</option>
            <option>BNBUSDT</option><option>XRPUSDT</option><option>ADAUSDT</option>
          </select>
        </div>
        <div class="ctrl-group">
          <label>Strategy</label>
          <select id="bt-strategy">
            <option value="all">All 3 Strategies</option>
            <option value="S1">S1 â€” HH Displacement</option>
            <option value="S2">S2 â€” Range Sweep</option>
            <option value="S3">S3 â€” SSL + MSS</option>
          </select>
        </div>
        <div class="ctrl-group">
          <label>From</label>
          <input type="date" id="bt-from" value="2024-01-01">
        </div>
        <div class="ctrl-group">
          <label>To</label>
          <input type="date" id="bt-to" value="2024-12-31">
        </div>
        <div class="ctrl-group">
          <label>Risk % per trade</label>
          <input type="number" id="bt-risk" value="1" min="0.1" max="10" step="0.1">
        </div>
        <div class="ctrl-group">
          <label>Min R:R</label>
          <input type="number" id="bt-minrr" value="2" min="1" max="10" step="0.5">
        </div>
        <div class="ctrl-group" style="display:flex;flex-direction:column;justify-content:flex-end;gap:6px">
          <div style="display:flex;gap:6px">
            <button class="btn-primary" id="run-backtest-btn" style="flex:1">â–¶ Run</button>
            <button class="btn-secondary" id="stop-backtest-btn" style="display:none;padding:7px 12px;color:var(--accent-red);border-color:rgba(255,61,90,0.3)">â–  Stop</button>
          </div>
          <div style="font-size:9px;color:var(--accent-green)">ğŸ”’ Spot only Â· No leverage</div>
        </div>
      </div>

      <div id="bt-progress-wrap" style="display:none;margin-bottom:12px">
        <div id="bt-progress-bar"><div id="bt-progress-fill"></div></div>
        <div id="bt-status" style="font-size:9px;color:var(--text-2);margin-top:4px">Preparing...</div>
      </div>

      <div id="bt-results">
        <div class="empty-state">
          <div class="empty-icon">ğŸ“Š</div>
          <p>Configure a date range and click Run.<br>
          Results include % gain per trade, equity %, full trade log.</p>
        </div>
      </div>
    </div>

    <!-- â•â•â• ANALYTICS â•â•â• -->
    <div class="view-panel" id="view-analytics">
      <div style="font-family:'Syne',sans-serif;font-size:16px;font-weight:800;color:var(--text-0);margin-bottom:14px">ğŸ“ˆ Performance Analytics</div>
      <div class="analytics-grid" id="analytics-content">
        <div class="analytics-card" style="grid-column:1/-1"><div class="empty-state"><div class="empty-icon">ğŸ“‰</div><p>Run a backtest first</p></div></div>
      </div>
    </div>

    <!-- â•â•â• TRADE JOURNAL â•â•â• -->
    <div class="view-panel" id="view-trades">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap;gap:8px">
        <div style="font-family:'Syne',sans-serif;font-size:16px;font-weight:800;color:var(--text-0)">ğŸ“ Trade Journal</div>
        <button onclick="openAddTradeModal(null)" class="btn-primary">â• Add Trade</button>
      </div>

      <div class="jstats-bar" id="journal-stats">
        <div class="jstat"><div class="jstat-label">Total Trades</div><div class="jstat-val">0</div></div>
      </div>

      <div style="background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius-lg);padding:10px 14px;margin-bottom:12px;font-size:9px;color:var(--text-2);line-height:1.7">
        ğŸ”’ <strong>SPOT ONLY</strong> â€” Track your actual positions. Log entry/exit, see P&L and % gain/loss on every trade. Use â• on signals to pre-fill from a detected setup.
      </div>

      <div id="manual-trades-container">
        <div class="empty-state"><div class="empty-icon">ğŸ“</div><p>No trades logged yet.<br>Click "+ Add Trade" or tap â• on any signal card.</p></div>
      </div>
    </div>

    <!-- â•â•â• SETTINGS â•â•â• -->
    <div class="view-panel" id="view-settings">
      <div style="font-family:'Syne',sans-serif;font-size:16px;font-weight:800;color:var(--text-0);margin-bottom:14px">âš™ï¸ Configuration</div>
      <div id="settings-panel"></div>
    </div>

  </main>

  <!-- SIDEBAR RIGHT -->
  <aside id="sidebar-right">
    <div>
      <div class="panel-title">Equity Curve</div>
      <canvas id="equity-mini-canvas"></canvas>
    </div>
    <div>
      <div class="panel-title">Risk Monitor</div>
      <div class="risk-row"><span class="risk-label">Risk / trade</span><span class="risk-val ok">1.00%</span></div>
      <div class="risk-row"><span class="risk-label">Daily limit</span><span class="risk-val ok">5.00%</span></div>
      <div class="risk-row"><span class="risk-label">Type</span><span class="risk-val" style="color:var(--accent-cyan)">SPOT</span></div>
      <div class="risk-row" style="border-bottom:none"><span class="risk-label">Session</span><span class="risk-val ok">VALID</span></div>
    </div>
    <div style="flex:1;overflow-y:auto;min-height:0">
      <div class="panel-title">Alert Log</div>
      <div id="alert-log"><div style="font-size:9px;color:var(--text-3);text-align:center;padding:16px">No alerts yet</div></div>
    </div>
    <div>
      <div class="panel-title">Strategy Reference</div>
      <div style="font-size:9px;color:var(--text-2);line-height:1.8">
        <div style="margin-bottom:6px"><span style="color:var(--s1-color);font-weight:700">S1</span> â€” 3+HH â†’ Sweep Down â†’ Disp Up â†’ 50% OB/FVG</div>
        <div style="margin-bottom:6px"><span style="color:var(--s2-color);font-weight:700">S2</span> â€” Range â†’ SSL Sweep â†’ Short Trap â†’ Disp Up</div>
        <div><span style="color:var(--s3-color);font-weight:700">S3</span> â€” Major SSL Sweep â†’ ICT MSS â†’ Impulse â†’ 50%</div>
      </div>
    </div>
  </aside>

</div><!-- #app-main -->

<!-- â”€â”€ TOAST â”€â”€ -->
<div id="toast-container"></div>

<!-- â”€â”€ CHART MODAL â”€â”€ -->
<div id="chart-modal" class="modal-overlay" style="display:none">
  <div class="modal-box" style="width:min(960px,96vw);height:min(620px,90vh);display:flex;flex-direction:column">
    <div class="modal-header">
      <span id="modal-title" style="font-family:'Syne',sans-serif;font-weight:700;font-size:13px"></span>
      <button class="modal-close">âœ•</button>
    </div>
    <div style="flex:1;position:relative;min-height:0">
      <canvas id="modal-canvas" style="width:100%;height:100%;display:block"></canvas>
    </div>
  </div>
</div>

<!-- â”€â”€ REASONING MODAL â”€â”€ -->
<div id="reasoning-modal" class="modal-overlay" style="display:none">
  <div class="modal-box" style="width:min(580px,96vw);max-height:80vh;display:flex;flex-direction:column">
    <div class="modal-header">
      <span id="reasoning-title" style="font-family:'Syne',sans-serif;font-weight:700;font-size:13px"></span>
      <button class="modal-close">âœ•</button>
    </div>
    <div style="flex:1;overflow-y:auto;padding:16px">
      <pre id="reasoning-body" style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-1);line-height:1.8;white-space:pre-wrap;word-break:break-word"></pre>
    </div>
  </div>
</div>

<!-- â”€â”€ ADD TRADE MODAL â”€â”€ -->
<div id="add-trade-modal" class="modal-overlay" style="display:none">
  <div class="modal-box" style="width:min(560px,96vw);max-height:90vh;display:flex;flex-direction:column">
    <div class="modal-header">
      <span style="font-family:'Syne',sans-serif;font-weight:700;font-size:13px">ğŸ“ Log Trade</span>
      <button class="modal-close">âœ•</button>
    </div>
    <div style="flex:1;overflow-y:auto;padding:18px">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div class="ctrl-group">
          <label>Symbol</label>
          <input type="text" id="mt-symbol" placeholder="BTCUSDT" style="text-transform:uppercase">
        </div>
        <div class="ctrl-group">
          <label>Strategy</label>
          <select id="mt-strategy">
            <option value="S1">S1 â€” HH Displacement</option>
            <option value="S2">S2 â€” Range Sweep</option>
            <option value="S3">S3 â€” SSL + MSS</option>
            <option value="manual">Manual Setup</option>
          </select>
        </div>
        <div class="ctrl-group">
          <label>Entry Price</label>
          <input type="number" id="mt-entry" placeholder="0.00" step="any">
        </div>
        <div class="ctrl-group">
          <label>Stop Loss</label>
          <input type="number" id="mt-sl" placeholder="0.00" step="any">
        </div>
        <div class="ctrl-group">
          <label>Take Profit</label>
          <input type="number" id="mt-tp" placeholder="0.00" step="any">
        </div>
        <div class="ctrl-group">
          <label>Position Size (qty)</label>
          <input type="number" id="mt-size" placeholder="0 = auto risk" step="any">
        </div>
        <div class="ctrl-group">
          <label>Status</label>
          <select id="mt-status">
            <option value="open">Open</option>
            <option value="closed">Closed</option>
          </select>
        </div>
        <div class="ctrl-group">
          <label>Exit Price (if closed)</label>
          <input type="number" id="mt-exit" placeholder="Optional" step="any">
        </div>
        <div class="ctrl-group" style="grid-column:1/-1">
          <label>Notes</label>
          <input type="text" id="mt-notes" placeholder="Setup notes, observations...">
        </div>
      </div>
      <div style="margin-top:16px;padding:10px;background:var(--bg-3);border-radius:6px;font-size:9px;color:var(--text-2);line-height:1.7">
        ğŸ”’ Spot only. R:R and expected % gain calculated automatically from entry/SL/TP.<br>
        Set exit price + status=Closed to log actual P&L and % gain/loss.
      </div>
    </div>
    <div style="padding:14px 18px;border-top:1px solid var(--border);display:flex;gap:8px">
      <button class="btn-primary" id="save-trade-btn" style="flex:1">ğŸ’¾ Save Trade</button>
      <button class="btn-secondary modal-close">Cancel</button>
    </div>
  </div>
</div>

<script type="module" src="js/main.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SMC Prop Engine | Institutional Trading System</title>
<link rel="stylesheet" href="css/styles.css">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='16' fill='%231e7fff'/><text y='72' x='12' font-size='72' font-family='monospace' fill='white' font-weight='bold'>S</text></svg>">
</head>
<body>

<!-- ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<header id="app-header">
  <div class="header-brand">
    <div class="brand-logo">S</div>
    <div>
      <div class="brand-name">SMC PROP ENGINE</div>
      <div class="brand-tag">INSTITUTIONAL GRADE ¬∑ v2.0</div>
    </div>
  </div>

  <nav class="nav-tabs">
    <button class="nav-tab active" data-view="live">‚ö° Live</button>
    <button class="nav-tab" data-view="backtest">üìä Backtest</button>
    <button class="nav-tab" data-view="analytics">üìà Analytics</button>
    <button class="nav-tab" data-view="settings">‚öôÔ∏è Settings</button>
  </nav>

  <div class="header-status">
    <div class="status-dot"></div>
    <span style="font-size:10px;color:var(--text-2)">LIVE</span>
    <span style="color:var(--text-3)">|</span>
    <select id="symbol-select" style="background:transparent;border:1px solid var(--border);color:var(--text-0);font-family:inherit;font-size:11px;padding:3px 6px;border-radius:4px;cursor:pointer;outline:none;"
      onchange="state&&(state.settings.symbol=this.value)&&saveSettings&&saveSettings()">
      <option>BTCUSDT</option><option>ETHUSDT</option><option>SOLUSDT</option>
      <option>BNBUSDT</option><option>XRPUSDT</option><option>ADAUSDT</option>
    </select>
    <span id="header-price" style="color:var(--accent-gold);font-size:11px;font-weight:600">--</span>
    <span style="color:var(--text-3)">|</span>
    <span class="header-equity" id="header-equity">$10,000</span>
    <span style="color:var(--text-3)">|</span>
    <span id="scan-status" style="font-size:9px;color:var(--text-3)">Initializing...</span>
  </div>
</header>

<!-- ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div id="app-main">

  <!-- ‚îÄ‚îÄ SIDEBAR LEFT ‚îÄ‚îÄ -->
  <aside id="sidebar-left">
    <div class="sidebar-section">
      <div class="sidebar-label">Aligned Bias</div>
      <div class="bias-card" style="border-color:rgba(0,212,255,0.2)">
        <div class="bias-tf">HTF CONFLUENCE</div>
        <div class="bias-val neutral" id="aligned-bias">‚óÜ NEUTRAL</div>
      </div>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-label">Timeframe Bias</div>
      <div id="bias-container">
        <div class="bias-card"><div class="bias-tf">15m</div><div class="bias-val neutral">‚óÜ SCANNING</div></div>
        <div class="bias-card"><div class="bias-tf">1H</div><div class="bias-val neutral">‚óÜ SCANNING</div></div>
        <div class="bias-card"><div class="bias-tf">4H</div><div class="bias-val neutral">‚óÜ SCANNING</div></div>
      </div>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-label">Session</div>
      <div id="session-display"><div class="session-badge off">‚è∏ Loading...</div></div>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-label">Liquidity Map</div>
      <div id="liquidity-container"><div style="font-size:9px;color:var(--text-3);text-align:center;padding:12px">Scanning...</div></div>
    </div>
    <div class="sidebar-section" style="border-bottom:none">
      <div class="sidebar-label">Strategies</div>
      <div id="strategy-toggles"></div>
    </div>
  </aside>

  <!-- ‚îÄ‚îÄ MAIN PANEL ‚îÄ‚îÄ -->
  <main id="main-panel">

    <!-- ‚ïê‚ïê‚ïê LIVE VIEW ‚ïê‚ïê‚ïê -->
    <div class="view-panel active" id="view-live">
      <div class="stats-bar">
        <div class="stat-card cyan"><div class="stat-label">Equity</div><div class="stat-value" id="stat-equity">$10,000</div><div class="stat-sub">Balance</div></div>
        <div class="stat-card green"><div class="stat-label">Win Rate</div><div class="stat-value green" id="stat-wr">--%</div><div class="stat-sub">Closed trades</div></div>
        <div class="stat-card blue"><div class="stat-label">Trades</div><div class="stat-value" id="stat-trades">0</div><div class="stat-sub">Total closed</div></div>
        <div class="stat-card red"><div class="stat-label">Drawdown</div><div class="stat-value red" id="stat-dd">0.00%</div><div class="stat-sub">Current</div></div>
        <div class="stat-card purple"><div class="stat-label">Session</div><div class="stat-value" id="stat-session" style="font-size:13px">--</div><div class="stat-sub">Active</div></div>
        <div class="stat-card gold"><div class="stat-label">Live Signals</div><div class="stat-value gold" id="stat-signals">0</div><div class="stat-sub">Active</div></div>
      </div>

      <div class="chart-container" style="min-height:320px;" id="main-canvas-container">
        <div class="chart-header">
          <div class="chart-symbol">
            <span id="chart-symbol-name">BTCUSDT</span>
            <span class="chart-price-live" id="chart-live-price"></span>
          </div>
          <div class="tf-buttons">
            <button class="tf-btn active" data-tf="15m">15m</button>
            <button class="tf-btn" data-tf="1H">1H</button>
            <button class="tf-btn" data-tf="4H">4H</button>
          </div>
        </div>
        <canvas id="main-canvas"></canvas>
      </div>

      <div style="margin-bottom:8px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:6px">
        <div style="font-family:'Syne',sans-serif;font-size:12px;font-weight:700;letter-spacing:0.08em;color:var(--text-1);text-transform:uppercase">Active Signals</div>
        <div style="font-size:9px;color:var(--text-3)">BIAS ‚Üí LIQUIDITY ‚Üí SWEEP ‚Üí DISPLACEMENT ‚Üí MSS ‚Üí ENTRY</div>
      </div>
      <div class="signals-grid" id="signals-container">
        <div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">‚è≥</div><p>Loading data and scanning...</p></div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê BACKTEST VIEW ‚ïê‚ïê‚ïê -->
    <div class="view-panel" id="view-backtest">
      <div style="font-family:'Syne',sans-serif;font-size:16px;font-weight:800;color:var(--text-0);margin-bottom:14px">üìä Quant Backtesting Engine</div>

      <div class="backtest-controls">
        <div class="ctrl-group">
          <label>Symbol</label>
          <select id="bt-symbol">
            <option>BTCUSDT</option><option>ETHUSDT</option><option>SOLUSDT</option>
            <option>BNBUSDT</option><option>XRPUSDT</option>
          </select>
        </div>
        <div class="ctrl-group">
          <label>Strategy</label>
          <select id="bt-strategy">
            <option value="all">All Strategies</option>
            <option value="S1">S1 ‚Äî Sweep‚ÜíMSS</option>
            <option value="S2">S2 ‚Äî Prem/Disc</option>
            <option value="S3">S3 ‚Äî HL Sweep</option>
          </select>
        </div>
        <div class="ctrl-group">
          <label>From</label>
          <input type="date" id="bt-from" value="2024-01-01">
        </div>
        <div class="ctrl-group">
          <label>To</label>
          <input type="date" id="bt-to" value="2024-12-31">
        </div>
        <div class="ctrl-group">
          <label>Risk % per trade</label>
          <input type="number" id="bt-risk" value="1" min="0.1" max="10" step="0.1">
        </div>
        <div class="ctrl-group">
          <label>Min R:R</label>
          <input type="number" id="bt-minrr" value="2" min="1" max="10" step="0.5">
        </div>
        <div class="ctrl-group">
          <label>Timeframes</label>
          <div style="display:flex;flex-wrap:wrap;gap:3px;margin-top:2px">
            <label style="display:inline-flex;align-items:center;gap:3px;font-size:9px;padding:2px 6px;border:1px solid var(--accent-cyan);border-radius:3px;color:var(--accent-cyan);background:rgba(0,212,255,0.08);cursor:pointer"><input type="checkbox" class="bt-tf-cb" value="15m" checked style="display:none">15m</label>
            <label style="display:inline-flex;align-items:center;gap:3px;font-size:9px;padding:2px 6px;border:1px solid var(--border);border-radius:3px;color:var(--text-2);cursor:pointer"><input type="checkbox" class="bt-tf-cb" value="1H" style="display:none">1H</label>
            <label style="display:inline-flex;align-items:center;gap:3px;font-size:9px;padding:2px 6px;border:1px solid var(--border);border-radius:3px;color:var(--text-2);cursor:pointer"><input type="checkbox" class="bt-tf-cb" value="4H" style="display:none">4H</label>
          </div>
        </div>
        <div class="ctrl-group" style="display:flex;flex-direction:column;justify-content:flex-end;gap:5px">
          <label style="display:flex;align-items:center;gap:6px;font-size:10px;color:var(--text-1);cursor:pointer">
            <input type="checkbox" id="bt-only-longs" style="accent-color:var(--accent-green)">
            Only Longs
          </label>
          <div style="display:flex;gap:6px">
            <button class="btn-primary" id="run-backtest-btn" style="flex:1">‚ñ∂ Run</button>
            <button class="btn-secondary" id="stop-backtest-btn" style="display:none;padding:7px 12px;color:var(--accent-red);border-color:rgba(255,61,90,0.3)">‚ñ† Stop</button>
          </div>
        </div>
      </div>

      <!-- BT Timeframe toggle styling -->
      <script>
        document.querySelectorAll('.bt-tf-cb').forEach(cb=>{
          cb.addEventListener('change',()=>{
            const lbl=cb.closest('label'),on=cb.checked;
            lbl.style.borderColor=on?'var(--accent-cyan)':'var(--border)';
            lbl.style.color=on?'var(--accent-cyan)':'var(--text-2)';
            lbl.style.background=on?'rgba(0,212,255,0.08)':'transparent';
          });
        });
      </script>

      <div id="bt-progress-wrap" style="display:none;margin-bottom:12px">
        <div id="bt-progress-bar"><div id="bt-progress-fill"></div></div>
        <div id="bt-status" style="font-size:9px;color:var(--text-2);margin-top:4px">Preparing...</div>
      </div>

      <div id="bt-results">
        <div class="empty-state">
          <div class="empty-icon">üìä</div>
          <p>Configure above and click Run Backtest.<br>Candle-by-candle simulation, no lookahead bias.<br>Paginated trade log (100/page) + Monte Carlo.</p>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê ANALYTICS VIEW ‚ïê‚ïê‚ïê -->
    <div class="view-panel" id="view-analytics">
      <div style="font-family:'Syne',sans-serif;font-size:16px;font-weight:800;color:var(--text-0);margin-bottom:14px">üìà Performance Analytics</div>
      <div class="analytics-grid" id="analytics-content">
        <div class="analytics-card" style="grid-column:1/-1">
          <div class="empty-state"><div class="empty-icon">üìâ</div><p>Run a backtest first to populate analytics</p></div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê SETTINGS VIEW ‚ïê‚ïê‚ïê -->
    <div class="view-panel" id="view-settings">
      <div style="font-family:'Syne',sans-serif;font-size:16px;font-weight:800;color:var(--text-0);margin-bottom:14px">‚öôÔ∏è Engine Configuration</div>
      <div id="settings-panel"></div>
    </div>

  </main>

  <!-- ‚îÄ‚îÄ SIDEBAR RIGHT ‚îÄ‚îÄ -->
  <aside id="sidebar-right">
    <div>
      <div class="panel-title">Equity Curve</div>
      <canvas id="equity-mini-canvas"></canvas>
      <div class="equity-stats">
        <div class="eq-stat"><div class="eq-label">Balance</div><div class="eq-val highlight-green" id="eq-balance">$10,000</div></div>
        <div class="eq-stat"><div class="eq-label">Drawdown</div><div class="eq-val highlight-red" id="eq-dd">0.00%</div></div>
        <div class="eq-stat"><div class="eq-label">Trades</div><div class="eq-val" id="eq-trades">0</div></div>
        <div class="eq-stat"><div class="eq-label">Win Rate</div><div class="eq-val" id="eq-wr">--%</div></div>
      </div>
    </div>
    <div>
      <div class="panel-title">Risk Monitor</div>
      <div class="risk-row"><span class="risk-label">Risk per trade</span><span class="risk-val ok">1.00%</span></div>
      <div class="risk-row"><span class="risk-label">Daily limit</span><span class="risk-val ok">5.00%</span></div>
      <div class="risk-row"><span class="risk-label">Open trades</span><span class="risk-val">0 / 3</span></div>
      <div class="risk-row"><span class="risk-label">Max drawdown</span><span class="risk-val">10.00%</span></div>
      <div class="risk-row" style="border-bottom:none"><span class="risk-label">Session</span><span class="risk-val ok">VALID</span></div>
    </div>
    <div style="flex:1;overflow-y:auto">
      <div class="panel-title">Alert Log</div>
      <div id="alert-log"><div style="font-size:9px;color:var(--text-3);text-align:center;padding:16px">No alerts yet</div></div>
    </div>
    <div>
      <div class="panel-title">SMC Sequence</div>
      <div style="font-size:9px;line-height:2;color:var(--text-2)">
        <div><span style="color:var(--accent-cyan);font-weight:700;margin-right:6px">1</span>HTF Bias confirmation</div>
        <div><span style="color:var(--accent-cyan);font-weight:700;margin-right:6px">2</span>Map liquidity pools</div>
        <div><span style="color:var(--accent-cyan);font-weight:700;margin-right:6px">3</span>Liquidity sweep</div>
        <div><span style="color:var(--accent-cyan);font-weight:700;margin-right:6px">4</span>Displacement candle</div>
        <div><span style="color:var(--accent-cyan);font-weight:700;margin-right:6px">5</span>Body close structure break</div>
        <div><span style="color:var(--accent-cyan);font-weight:700;margin-right:6px">6</span>OB/FVG retracement</div>
        <div><span style="color:var(--accent-cyan);font-weight:700;margin-right:6px">7</span>Entry + risk management</div>
      </div>
    </div>
  </aside>

</div>

<!-- ‚îÄ‚îÄ TOAST CONTAINER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div id="toast-container"></div>

<!-- ‚îÄ‚îÄ CHART MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div id="chart-modal" class="modal-overlay" style="display:none">
  <div class="modal-box" style="width:min(900px,95vw);height:min(600px,90vh);display:flex;flex-direction:column">
    <div class="modal-header">
      <span id="modal-title" style="font-family:'Syne',sans-serif;font-weight:700;font-size:13px"></span>
      <button class="modal-close">‚úï</button>
    </div>
    <div style="flex:1;position:relative;min-height:0">
      <canvas id="modal-canvas" style="width:100%;height:100%;display:block"></canvas>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ REASONING MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div id="reasoning-modal" class="modal-overlay" style="display:none">
  <div class="modal-box" style="width:min(580px,95vw);max-height:80vh;display:flex;flex-direction:column">
    <div class="modal-header">
      <span id="reasoning-title" style="font-family:'Syne',sans-serif;font-weight:700;font-size:13px"></span>
      <button class="modal-close">‚úï</button>
    </div>
    <div style="flex:1;overflow-y:auto;padding:16px">
      <pre id="reasoning-body" style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-1);line-height:1.7;white-space:pre-wrap;word-break:break-word"></pre>
    </div>
  </div>
</div>

<script type="module" src="js/main.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SMC Crypto Scanner â€” Institutional Alert System</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#050810;--bg2:#090d1a;--bg3:#0d1526;
  --card:#0f1a2e;--card2:#132035;
  --border:#1e3058;--border2:#2a4070;
  --accent:#00d4ff;--accent2:#0088cc;
  --green:#00ff88;--green2:#00cc6a;
  --red:#ff3366;--red2:#cc0044;
  --orange:#ff8800;--yellow:#ffd700;--purple:#cc88ff;
  --text:#e8f0ff;--text2:#8899bb;--text3:#445577;
  --mono:'Space Mono',monospace;--sans:'Syne',sans-serif;
  --glow:0 0 20px rgba(0,212,255,0.3);
  --glow-g:0 0 20px rgba(0,255,136,0.3);
  --glow-r:0 0 20px rgba(255,51,102,0.3);
}
*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{background:var(--bg);color:var(--text);font-family:var(--sans);min-height:100vh;overflow-x:hidden;}
body::before{
  content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image:linear-gradient(rgba(0,212,255,0.025) 1px,transparent 1px),linear-gradient(90deg,rgba(0,212,255,0.025) 1px,transparent 1px);
  background-size:50px 50px;
}
header{
  position:sticky;top:0;z-index:100;
  background:rgba(5,8,16,0.96);backdrop-filter:blur(24px);
  border-bottom:1px solid var(--border);
  padding:0 20px;height:62px;
  display:flex;align-items:center;justify-content:space-between;
}
.logo{display:flex;align-items:center;gap:10px;font-size:18px;font-weight:800;letter-spacing:-.5px;}
.logo-icon{width:34px;height:34px;background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px;box-shadow:var(--glow);}
.logo span{color:var(--accent);}
nav{display:flex;gap:2px;}
.nav-btn{background:none;border:none;cursor:pointer;font-family:var(--sans);font-size:13px;font-weight:600;color:var(--text2);padding:7px 14px;border-radius:6px;transition:all .2s;}
.nav-btn:hover,.nav-btn.active{color:var(--accent);background:rgba(0,212,255,0.08);}
.hdr-right{display:flex;align-items:center;gap:10px;}
.status-pill{display:flex;align-items:center;gap:7px;font-family:var(--mono);font-size:10px;color:var(--text2);background:var(--card);border:1px solid var(--border);padding:5px 12px;border-radius:20px;}
.dot{width:7px;height:7px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green);animation:blink 1.6s ease-in-out infinite;}
@keyframes blink{0%,100%{opacity:1;}50%{opacity:.4;}}
.new-badge{background:var(--red);color:#fff;font-family:var(--mono);font-size:10px;font-weight:700;padding:3px 9px;border-radius:10px;box-shadow:var(--glow-r);min-width:60px;text-align:center;}
.countdown-pill{font-family:var(--mono);font-size:10px;color:var(--yellow);background:var(--card);border:1px solid var(--border);padding:5px 12px;border-radius:20px;}
main{position:relative;z-index:1;padding:20px;}
.page{display:none;}.page.active{display:block;}
.stats-bar{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-bottom:20px;}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px 18px;transition:border-color .2s;}
.stat-card:hover{border-color:var(--border2);}
.slbl{font-family:var(--mono);font-size:9px;color:var(--text3);letter-spacing:1px;text-transform:uppercase;}
.sval{font-family:var(--mono);font-size:20px;font-weight:700;margin-top:3px;}
.sval.ac{color:var(--accent);}.sval.gr{color:var(--green);}.sval.rd{color:var(--red);}
.sval.yl{color:var(--yellow);}.sval.pu{color:var(--purple);}
.ssub{font-size:10px;color:var(--text3);margin-top:2px;}
.section-title{font-size:11px;font-weight:700;color:var(--text2);letter-spacing:2px;text-transform:uppercase;margin-bottom:12px;display:flex;align-items:center;gap:8px;}
.section-title::before{content:'';width:3px;height:14px;background:var(--accent);border-radius:2px;box-shadow:var(--glow);}
.watchlist-wrap{margin-bottom:18px;}
.watchlist-tabs{display:flex;gap:4px;margin-bottom:10px;}
.wtab{background:var(--bg2);border:1px solid var(--border);border-radius:6px;font-family:var(--mono);font-size:10px;color:var(--text3);padding:4px 12px;cursor:pointer;transition:all .2s;}
.wtab.active{background:rgba(0,212,255,0.1);border-color:var(--accent);color:var(--accent);}
.watchlist-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:6px;}
.witem{background:var(--card);border:1px solid var(--border);border-radius:7px;padding:8px 10px;cursor:pointer;transition:all .2s;}
.witem:hover{border-color:var(--accent);transform:translateY(-1px);}
.wsym{font-family:var(--mono);font-size:11px;font-weight:700;}
.wprice{font-family:var(--mono);font-size:10px;color:var(--text2);margin-top:2px;}
.wchg{font-family:var(--mono);font-size:10px;margin-top:1px;}
.wchg.up{color:var(--green);}.wchg.dn{color:var(--red);}
.controls{display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:16px;}
.fg{display:flex;gap:3px;background:var(--bg2);border:1px solid var(--border);border-radius:7px;padding:3px;}
.fb{background:none;border:none;cursor:pointer;font-family:var(--mono);font-size:10px;color:var(--text2);padding:5px 12px;border-radius:5px;transition:all .2s;white-space:nowrap;}
.fb.active{background:var(--accent);color:var(--bg);font-weight:700;}
.fb:hover:not(.active){color:var(--accent);background:rgba(0,212,255,.1);}
.si{background:var(--card);border:1px solid var(--border);border-radius:7px;padding:7px 12px;font-family:var(--mono);font-size:11px;color:var(--text);outline:none;transition:border-color .2s;}
.si:focus{border-color:var(--accent);}
.si::placeholder{color:var(--text3);}
select.si{cursor:pointer;}
.cbtn{background:var(--card);border:1px solid var(--border);border-radius:7px;padding:7px 12px;cursor:pointer;font-family:var(--mono);font-size:10px;color:var(--text2);transition:all .2s;display:flex;align-items:center;gap:5px;white-space:nowrap;}
.cbtn:hover,.cbtn.on{border-color:var(--accent);color:var(--accent);}
.ath{display:grid;grid-template-columns:82px 130px 65px 75px 100px 60px 62px 75px 1fr 28px;gap:10px;padding:7px 16px;border-bottom:1px solid var(--border);margin-bottom:4px;}
.ath span{font-family:var(--mono);font-size:9px;color:var(--text3);letter-spacing:1px;text-transform:uppercase;}
.alerts-list{display:flex;flex-direction:column;gap:5px;}
.arow{background:var(--card);border:1px solid var(--border);border-radius:9px;padding:12px 16px;cursor:pointer;transition:all .2s;display:grid;grid-template-columns:82px 130px 65px 75px 100px 60px 62px 75px 1fr 28px;align-items:center;gap:10px;position:relative;overflow:hidden;}
.arow::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;border-radius:3px 0 0 3px;}
.arow.long::before{background:var(--green);box-shadow:var(--glow-g);}
.arow.short::before{background:var(--red);box-shadow:var(--glow-r);}
.arow:hover{border-color:var(--accent);background:var(--card2);transform:translateX(2px);}
.arow.fresh{animation:slideIn .4s ease-out;}
@keyframes slideIn{from{opacity:0;transform:translateX(-16px);}to{opacity:1;transform:translateX(0);}}
.asymbol{font-family:var(--mono);font-size:12px;font-weight:700;}
.astrat{font-family:var(--mono);font-size:9px;background:rgba(0,212,255,.08);border:1px solid rgba(0,212,255,.2);color:var(--accent);padding:3px 7px;border-radius:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.atf{font-family:var(--mono);font-size:10px;}
.adir{font-family:var(--mono);font-size:10px;font-weight:700;padding:3px 9px;border-radius:4px;text-align:center;}
.adir.long{background:rgba(0,255,136,.12);color:var(--green);border:1px solid rgba(0,255,136,.3);}
.adir.short{background:rgba(255,51,102,.12);color:var(--red);border:1px solid rgba(255,51,102,.3);}
.aprice{font-family:var(--mono);font-size:11px;}
.arr{font-family:var(--mono);font-size:10px;color:var(--yellow);}
.awr{font-family:var(--mono);font-size:10px;color:var(--text2);}
.atime{font-family:var(--mono);font-size:9px;color:var(--text3);}
.achrt{border-radius:3px;overflow:hidden;background:var(--bg3);}
.aarr{color:var(--text3);font-size:13px;}
.overlay{position:fixed;inset:0;background:rgba(5,8,16,.93);backdrop-filter:blur(10px);z-index:1000;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .25s;}
.overlay.open{opacity:1;pointer-events:all;}
.modal{background:var(--card);border:1px solid var(--border2);border-radius:16px;width:min(920px,96vw);max-height:92vh;overflow-y:auto;transform:scale(.96) translateY(16px);transition:transform .25s;box-shadow:0 40px 120px rgba(0,0,0,.85);}
.overlay.open .modal{transform:scale(1) translateY(0);}
.mhdr{padding:22px 26px;border-bottom:1px solid var(--border);display:flex;align-items:flex-start;justify-content:space-between;position:sticky;top:0;background:var(--card);z-index:5;border-radius:16px 16px 0 0;}
.msym{font-size:26px;font-weight:800;letter-spacing:-1px;}
.msub{font-family:var(--mono);font-size:11px;color:var(--text2);margin-top:5px;}
.mclose{background:none;border:1px solid var(--border);border-radius:7px;color:var(--text2);cursor:pointer;font-size:16px;width:34px;height:34px;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0;}
.mclose:hover{border-color:var(--red);color:var(--red);}
.mbody{padding:22px 26px;display:flex;flex-direction:column;gap:16px;}
/* FIX 1: chart container has explicit height, canvas fills it */
.mchrt{background:var(--bg2);border:1px solid var(--border);border-radius:10px;height:310px;overflow:hidden;position:relative;}
.mchrt canvas{display:block;width:100%!important;height:310px!important;}
.msg{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;}
.ms{background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:10px 14px;}
.ms .l{font-family:var(--mono);font-size:9px;color:var(--text3);letter-spacing:1px;text-transform:uppercase;}
.ms .v{font-family:var(--mono);font-size:15px;font-weight:700;margin-top:4px;}
.mlvls{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
.lvlcard{background:var(--bg2);border-radius:7px;padding:10px 12px;}
.lvlcard .ll{font-family:var(--mono);font-size:9px;color:var(--text3);letter-spacing:1px;}
.lvlcard .lv{font-family:var(--mono);font-size:13px;font-weight:700;margin-top:3px;}
.lvlcard.en .lv{color:var(--accent);}
.lvlcard.sl .lv{color:var(--red);}
.lvlcard.t1 .lv{color:var(--green);}
.lvlcard.t2 .lv{color:var(--green2);}
.lvlcard.t3 .lv{color:var(--yellow);}
.lvlcard.rr .lv{color:var(--yellow);}
.expl{background:var(--bg2);border:1px solid var(--border);border-left:3px solid var(--accent);border-radius:8px;padding:14px 16px;}
.expl h4{font-size:12px;font-weight:700;color:var(--accent);margin-bottom:7px;letter-spacing:1px;}
.expl p{font-size:13px;line-height:1.75;color:var(--text2);}
.dbadge{display:inline-flex;align-items:center;gap:6px;border-radius:5px;padding:5px 12px;font-family:var(--mono);font-size:11px;font-weight:700;margin-left:8px;}
.dbadge.long{background:rgba(0,255,136,.12);border:1px solid var(--green);color:var(--green);}
.dbadge.short{background:rgba(255,51,102,.12);border:1px solid var(--red);color:var(--red);}
.sbadge{display:inline-flex;align-items:center;gap:6px;background:rgba(0,212,255,.1);border:1px solid var(--accent);border-radius:5px;padding:5px 12px;font-family:var(--mono);font-size:11px;color:var(--accent);margin-left:6px;}
.toast-wrap{position:fixed;bottom:20px;right:20px;z-index:2000;display:flex;flex-direction:column;gap:8px;align-items:flex-end;}
.toast{background:var(--card2);border:1px solid var(--border2);border-radius:11px;padding:12px 16px;min-width:280px;max-width:360px;display:flex;align-items:flex-start;gap:10px;cursor:pointer;animation:tIn .3s ease-out;box-shadow:0 16px 50px rgba(0,0,0,.6);}
@keyframes tIn{from{opacity:0;transform:translateX(30px);}to{opacity:1;transform:translateX(0);}}
@keyframes tOut{to{opacity:0;transform:translateX(30px);}}
.toast.out{animation:tOut .25s ease-in forwards;}
.toast.long-t{border-left:3px solid var(--green);}
.toast.short-t{border-left:3px solid var(--red);}
.tico{font-size:18px;flex-shrink:0;margin-top:1px;}
.ttitle{font-size:12px;font-weight:700;}
.tbody{font-family:var(--mono);font-size:10px;color:var(--text2);margin-top:3px;}
.ttime{font-family:var(--mono);font-size:9px;color:var(--text3);margin-top:3px;}
.sg{display:flex;flex-direction:column;gap:18px;}
.sc{background:var(--card);border:1px solid var(--border);border-radius:13px;overflow:hidden;transition:border-color .2s;}
.sc:hover{border-color:var(--border2);}
.sch{padding:18px 22px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:14px;}
.snum{width:42px;height:42px;border-radius:9px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-family:var(--mono);font-size:16px;font-weight:700;}
.stitle{font-size:17px;font-weight:700;letter-spacing:-.3px;}
.stagline{font-size:12px;color:var(--text2);margin-top:2px;}
.wrbadge{margin-left:auto;font-family:var(--mono);font-size:13px;font-weight:700;background:rgba(0,255,136,.08);border:1px solid var(--green2);color:var(--green);padding:5px 14px;border-radius:7px;flex-shrink:0;}
.scb{padding:18px 22px;display:grid;grid-template-columns:1fr 1fr;gap:18px;}
.cond-list{display:flex;flex-direction:column;gap:7px;}
.cond-item{display:flex;align-items:flex-start;gap:8px;font-size:12px;line-height:1.55;color:var(--text2);}
.cond-item::before{content:'â†’';color:var(--accent);flex-shrink:0;font-family:var(--mono);margin-top:1px;}
.tm-box{background:var(--bg2);border:1px solid var(--border);border-radius:7px;padding:12px 14px;margin-bottom:10px;}
.tm-lbl{font-family:var(--mono);font-size:9px;color:var(--text3);letter-spacing:1px;text-transform:uppercase;margin-bottom:5px;}
.tm-val{font-size:12px;color:var(--text2);}
.s-desc{font-size:12px;color:var(--text2);line-height:1.7;padding:12px 14px;background:var(--bg2);border-radius:7px;margin-top:8px;}
.sstats{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;padding:12px 22px;border-top:1px solid var(--border);}
.ss{text-align:center;padding:8px;}
.ss .sv{font-family:var(--mono);font-size:14px;font-weight:700;color:var(--accent);}
.ss .sl{font-size:9px;color:var(--text3);margin-top:2px;}
.setgrid{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
.setcard{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:18px 22px;}
.setcard h3{font-size:13px;font-weight:700;color:var(--accent);margin-bottom:14px;letter-spacing:.5px;}
.setr{display:flex;align-items:center;justify-content:space-between;padding:9px 0;border-bottom:1px solid var(--border);}
.setr:last-child{border-bottom:none;}
.setr-lbl{font-size:12px;color:var(--text2);}
.setr-sub{font-size:10px;color:var(--text3);margin-top:2px;}
.tog{width:42px;height:22px;background:var(--bg3);border:1px solid var(--border);border-radius:11px;cursor:pointer;position:relative;transition:all .3s;flex-shrink:0;}
.tog.on{background:var(--accent2);border-color:var(--accent);}
.tog::after{content:'';position:absolute;top:2px;left:2px;width:16px;height:16px;border-radius:8px;background:var(--text3);transition:all .3s;}
.tog.on::after{left:22px;background:#fff;}
.rinput{background:var(--bg3);border:1px solid var(--border);border-radius:5px;padding:3px 8px;font-family:var(--mono);font-size:11px;color:var(--text);width:70px;text-align:center;outline:none;}
/* FIX 2: Prominent save button */
.save-btn-main{
  background:linear-gradient(135deg,var(--accent2),var(--accent));
  border:none;border-radius:10px;color:#fff;
  font-family:var(--mono);font-size:13px;font-weight:700;
  padding:13px 38px;cursor:pointer;transition:all .25s;letter-spacing:1px;
  box-shadow:0 4px 22px rgba(0,212,255,0.35);margin-top:18px;
}
.save-btn-main:hover{transform:translateY(-1px);box-shadow:0 6px 28px rgba(0,212,255,0.5);}
.save-btn-main.saved{background:linear-gradient(135deg,#00cc6a,#00ff88);box-shadow:0 4px 22px rgba(0,255,136,0.35);}
.save-status{font-family:var(--mono);font-size:11px;color:var(--green);margin-top:10px;min-height:18px;}
.empty{text-align:center;padding:50px 20px;color:var(--text3);}
.empty .ei{font-size:44px;margin-bottom:14px;}
.empty h3{font-size:15px;color:var(--text2);margin-bottom:6px;}
.empty p{font-size:12px;}
::-webkit-scrollbar{width:5px;}
::-webkit-scrollbar-track{background:var(--bg);}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px;}
@media(max-width:900px){
  .stats-bar{grid-template-columns:repeat(3,1fr);}
  .ath,.arow{grid-template-columns:75px 110px 60px 70px 90px 55px 55px 1fr 22px;}
  .atime,.awr{display:none;}
  .scb{grid-template-columns:1fr;}
  .msg{grid-template-columns:repeat(2,1fr);}
  .setgrid{grid-template-columns:1fr;}
}
@media(max-width:600px){
  main{padding:10px;}
  .ath,.arow{grid-template-columns:65px 95px 55px 65px 1fr 22px;}
  .arr,.atime,.awr,.achrt{display:none;}
  .stats-bar{grid-template-columns:repeat(2,1fr);}
  .mlvls{grid-template-columns:repeat(2,1fr);}
}
</style>
</head>
<body>

<header>
  <div class="logo"><div class="logo-icon">âš¡</div>SMC <span>SCANNER</span></div>
  <nav>
    <button class="nav-btn active" onclick="showPage('alerts')">Alerts</button>
    <button class="nav-btn" onclick="showPage('strategies')">Strategies</button>
    <button class="nav-btn" onclick="showPage('settings')">Settings</button>
  </nav>
  <div class="hdr-right">
    <div class="countdown-pill">Next scan: <span id="cdTimer">5:00</span></div>
    <div class="status-pill"><div class="dot" id="sDot"></div><span id="sTxt">LIVE</span></div>
    <div class="new-badge" id="newBadge">0 NEW</div>
  </div>
</header>

<main>
<div class="page active" id="page-alerts">
  <div class="stats-bar">
    <div class="stat-card"><div class="slbl">Total Alerts (24h)</div><div class="sval ac" id="stTotal">0</div><div class="ssub">All strategies</div></div>
    <div class="stat-card"><div class="slbl">Long Setups</div><div class="sval gr" id="stLong">0</div><div class="ssub">Buy signals</div></div>
    <div class="stat-card"><div class="slbl">Short Setups</div><div class="sval rd" id="stShort">0</div><div class="ssub">Sell signals</div></div>
    <div class="stat-card"><div class="slbl">Avg R:R</div><div class="sval yl" id="stRR">â€”</div><div class="ssub">Min threshold: 1:3</div></div>
    <div class="stat-card"><div class="slbl">Symbols Scanned</div><div class="sval pu" id="stSyms">0</div><div class="ssub">Mcap+Volume+Gainers</div></div>
  </div>
  <div class="watchlist-wrap">
    <div class="section-title">Live Market â€” Binance Top Pairs</div>
    <div class="watchlist-tabs">
      <div class="wtab active" onclick="switchWTab(this,'mcap')">By MCap</div>
      <div class="wtab" onclick="switchWTab(this,'vol')">By Volume</div>
      <div class="wtab" onclick="switchWTab(this,'gain')">Gainers</div>
    </div>
    <div class="watchlist-grid" id="wGrid"></div>
  </div>
  <div class="controls">
    <div class="fg">
      <button class="fb active" onclick="setFilter('tf','ALL',this)">ALL TF</button>
      <button class="fb" onclick="setFilter('tf','15m',this)">15m</button>
      <button class="fb" onclick="setFilter('tf','1h',this)">1H</button>
    </div>
    <div class="fg">
      <button class="fb active" onclick="setFilter('dir','ALL',this)">BOTH</button>
      <button class="fb" onclick="setFilter('dir','LONG',this)">LONG</button>
      <button class="fb" onclick="setFilter('dir','SHORT',this)">SHORT</button>
    </div>
    <select class="si" id="stratSel" onchange="setFilter('strat','',null)">
      <option value="ALL">All Strategies</option>
      <option value="1">S1: OB + BOS Retest</option>
      <option value="2">S2: FVG + CHoCH Entry</option>
      <option value="3">S3: Liquidity Sweep Reversal</option>
      <option value="4">S4: Breaker Block Flip</option>
      <option value="5">S5: MSS + OTE Fibonacci</option>
      <option value="6">S6: HL Sweep Reversal (Custom)</option>
    </select>
    <input class="si" type="text" id="searchIn" placeholder="Search symbolâ€¦" oninput="renderAlerts()">
    <button class="cbtn on" id="sndBtn" onclick="toggleSound()">ğŸ”” Sound ON</button>
    <button class="cbtn" onclick="clearAlerts()">ğŸ—‘ Clear All</button>
    <button class="cbtn" onclick="forceScan()">ğŸ”„ Scan Now</button>
  </div>
  <div class="section-title">Setup Alerts <span id="acTxt" style="font-weight:400;color:var(--text3);font-family:var(--mono);font-size:10px;margin-left:6px;"></span></div>
  <div class="ath">
    <span>Symbol</span><span>Strategy</span><span>TF</span><span>Direction</span>
    <span>Entry</span><span>R:R</span><span>Win%</span><span>Time</span>
    <span>Mini Chart</span><span></span>
  </div>
  <div class="alerts-list" id="alertsList">
    <div class="empty"><div class="ei">ğŸ“¡</div><h3>Scanner Initializing</h3><p>Fetching live pairs from Binance â€” mcap, volume &amp; gainers lists</p></div>
  </div>
</div>

<div class="page" id="page-strategies">
  <div class="section-title">6 Institutional SMC Strategies</div>
  <p style="font-size:13px;color:var(--text2);margin-bottom:22px;max-width:820px;line-height:1.7;">Five battle-tested ICT/SMC strategies plus one custom Higher Lows Sweep pattern. All setups enforce minimum 1:3 R:R. Every condition is algorithmically verified on real Binance kline data before an alert fires.</p>
  <div class="sg" id="stratsGrid"></div>
</div>

<div class="page" id="page-settings">
  <div class="section-title">Scanner Configuration</div>
  <div class="setgrid">
    <div class="setcard">
      <h3>ğŸ“¡ Data Source</h3>
      <div class="setr"><div><div class="setr-lbl">Exchange</div><div class="setr-sub">Binance public REST API</div></div><span style="font-family:var(--mono);font-size:11px;color:var(--accent)">BINANCE</span></div>
      <div class="setr"><div><div class="setr-lbl">Scan Interval</div><div class="setr-sub">Minutes between full scans</div></div><div style="display:flex;align-items:center;gap:6px;"><input class="rinput" type="number" id="scanMins" value="5" min="1" max="60"><span style="font-family:var(--mono);font-size:10px;color:var(--text3)">min</span></div></div>
      <div class="setr"><div><div class="setr-lbl">Timeframes</div><div class="setr-sub">Both scanned per symbol</div></div><span style="font-family:var(--mono);font-size:11px;color:var(--accent)">15m + 1H</span></div>
      <div class="setr"><div><div class="setr-lbl">Symbols Scanned</div><div class="setr-sub">Top 20 Ã— 3 categories</div></div><span style="font-family:var(--mono);font-size:11px;color:var(--accent)" id="setSymCount">â€”</span></div>
      <div class="setr"><div><div class="setr-lbl">Auto Scan</div><div class="setr-sub">Continuous background scanning</div></div><div class="tog on" id="autoTog" onclick="this.classList.toggle('on')"></div></div>
    </div>
    <div class="setcard">
      <h3>ğŸ”” Notifications</h3>
      <div class="setr"><div><div class="setr-lbl">Sound Alerts</div><div class="setr-sub">Ascending = long, descending = short</div></div><div class="tog on" id="sndTog" onclick="this.classList.toggle('on');syncSoundBtn()"></div></div>
      <div class="setr"><div><div class="setr-lbl">Push Notifications</div><div class="setr-sub">Browser push (works on mobile PWA)</div></div><div class="tog" id="pushTog" onclick="reqPush(this)"></div></div>
      <div class="setr"><div><div class="setr-lbl">Toast Popups</div><div class="setr-sub">Bottom-right alert cards</div></div><div class="tog on" id="toastTog" onclick="this.classList.toggle('on')"></div></div>
      <div class="setr"><div><div class="setr-lbl">Min R:R Filter</div><div class="setr-sub">Discard setups below this threshold</div></div><input class="rinput" type="number" id="minRRIn" value="3" min="1" max="10" step="0.5"></div>
    </div>
    <div class="setcard">
      <h3>ğŸ¯ Strategy Toggles</h3>
      <div id="stratToggles"></div>
    </div>
    <div class="setcard">
      <h3>ğŸ“± Deploy to GitHub Pages</h3>
      <div style="font-size:12px;color:var(--text2);line-height:1.8;">
        <p style="color:var(--accent);font-family:var(--mono);font-size:10px;margin-bottom:8px;">1. Create public GitHub repo</p>
        <p style="color:var(--accent);font-family:var(--mono);font-size:10px;margin-bottom:8px;">2. Upload this file as <b>index.html</b></p>
        <p style="color:var(--accent);font-family:var(--mono);font-size:10px;margin-bottom:8px;">3. Repo Settings â†’ Pages â†’ Deploy from main</p>
        <p style="color:var(--accent);font-family:var(--mono);font-size:10px;margin-bottom:8px;">4. Open your Pages URL on phone</p>
        <p style="color:var(--accent);font-family:var(--mono);font-size:10px;margin-bottom:12px;">5. Phone menu â†’ Add to Home Screen</p>
        <p style="color:var(--text3);font-size:11px;">Binance API is CORS-open â€” no backend or proxy needed. Screen wake-lock keeps scanner running.</p>
      </div>
    </div>
  </div>
  <!-- FIX 2: Big prominent Save Settings button -->
  <div style="margin-top:4px;">
    <button class="save-btn-main" id="mainSaveBtn" onclick="saveSettings()">ğŸ’¾ SAVE SETTINGS</button>
    <div class="save-status" id="saveStatus"></div>
  </div>
</div>
</main>

<div class="overlay" id="overlay" onclick="closeOverlay(event)">
  <div class="modal" id="modal">
    <div class="mhdr">
      <div>
        <div style="display:flex;align-items:center;flex-wrap:wrap;gap:6px;">
          <div class="msym" id="mSym">â€”</div>
          <div class="dbadge" id="mDir">â€”</div>
          <div class="sbadge" id="mStrat">â€”</div>
        </div>
        <div class="msub" id="mSub">â€”</div>
      </div>
      <button class="mclose" onclick="closeOverlay()">âœ•</button>
    </div>
    <div class="mbody">
      <!-- FIX 1: chart canvas inside named container -->
      <div class="mchrt" id="mChrtBox"><canvas id="mCanvas"></canvas></div>
      <div class="msg">
        <div class="ms"><div class="l">ENTRY</div><div class="v" id="mEn" style="color:var(--accent)">â€”</div></div>
        <div class="ms"><div class="l">STOP LOSS</div><div class="v" id="mSL" style="color:var(--red)">â€”</div></div>
        <div class="ms"><div class="l">R:R RATIO</div><div class="v" id="mRR" style="color:var(--yellow)">â€”</div></div>
        <div class="ms"><div class="l">WIN RATE</div><div class="v" id="mWR" style="color:var(--green)">â€”</div></div>
      </div>
      <div class="mlvls" id="mLvls"></div>
      <div class="expl"><h4 id="eTitle">ANALYSIS</h4><p id="eTxt">â€”</p></div>
    </div>
  </div>
</div>
<div class="toast-wrap" id="toastWrap"></div>

<script>
'use strict';

const STRATS = [
  {id:1,name:'Order Block Retest + Break of Structure',short:'OB + BOS Retest',winRate:68,rrMin:3,rrMax:7,color:'#00d4ff',tags:['Order Block','BOS','Market Structure'],conditions:['Identify the last opposing candle before a strong impulsive move â€” this is the Order Block (OB)','The impulse following the OB must break a prior swing high (bull) or swing low (bear) â€” this is the BOS','BOS candle must be at least 1.5Ã— the average candle range â€” displacement confirmation','Price retraces back into the OB zone (between 50% and 100% of the OB body)','A confirmation candle (bullish engulf / bearish engulf / pin bar) must close inside or just beyond the OB','Volume on the BOS impulse must be above 20-bar average â€” institutional participation'],entry:'OB midpoint (50% of body). Limit order placed in advance.',sl:'Below OB wick low (long) or above OB wick high (short), plus 0.5Ã— ATR buffer',tp:'Next liquidity pool, equal highs/lows, or opposing HTF OB. Minimum 1:3 R:R enforced.',desc:'After institutions accumulate/distribute at an OB, price often breaks structure then returns to the OB to fill remaining orders before continuing. The OB midpoint is the highest-probability entry as it sits between order absorption zones.'},
  {id:2,name:'Fair Value Gap + Change of Character Entry',short:'FVG + CHoCH',winRate:65,rrMin:3,rrMax:8,color:'#00ff88',tags:['FVG','CHoCH','Imbalance','Reversal'],conditions:['Change of Character (CHoCH): price makes the FIRST break of the prior trend structure â€” signals potential reversal','The displacement candle creating CHoCH must leave a Fair Value Gap (3-candle imbalance: gap between candle[i-1] high and candle[i+1] low)','FVG must be at least 0.5Ã— ATR wide â€” too small = noise, not institutional imbalance','No prior partial fill of the FVG (price must not have re-entered the gap before this setup)','Price returns to test the FVG from the direction of CHoCH â€” this is the entry zone','Entry at 50% of FVG (equilibrium). FVG in premium zone = short, discount zone = long'],entry:'50% of FVG (equilibrium of the imbalance). Limit or market on touch.',sl:'Beyond the CHoCH origin candle â€” where the structure shift is invalidated',tp:'Previous swing structure / next liquidity pool in new direction. Scaled exits at 1:3 and 1:5.',desc:'CHoCH is the first sign institutions are changing directional bias. The FVG they leave is an order cluster that price is magnetically drawn back to. Entering at FVG equilibrium puts you inside the institutional order block with tight SL.'},
  {id:3,name:'Liquidity Sweep + Immediate Reversal',short:'Liquidity Sweep Reversal',winRate:73,rrMin:3,rrMax:11,color:'#ff8800',tags:['Liquidity Sweep','Stop Hunt','Kill Zone','Manipulation'],conditions:['Equal highs or equal lows must be visible (at least 2 touches) â€” these are retail stop clusters','Price wicks aggressively through the level (the "sweep") â€” clearing stops above/below','The sweeping candle CLOSES BACK below the swept high (bear setup) or above the swept low (bull setup) â€” rejection confirmed on close','The next candle immediately confirms reversal direction â€” no indecision allowed','Sweep ideally occurs during London Open (07:00-09:00 UTC) or NY Open (13:00-15:00 UTC) kill zones','The sweep candle wick extension must be at least 1Ã— ATR beyond the liquidity level'],entry:'Close of the sweeping candle, or open of the next confirmation candle',sl:'2-3 pips/ticks beyond the sweep wick extreme â€” invalidation if price continues through',tp:'Opposing equal highs/lows / next structure level. Very tight SL = very high R:R (often 1:6+)',desc:'Highest win-rate setup. Institutions hunt retail stops above obvious levels then reverse hard. The tell is the full candle close back inside the range after the wick through â€” institutions have filled their orders and are now moving price. Speed of rejection = strength of signal.'},
  {id:4,name:'Breaker Block Mitigation',short:'Breaker Block Flip',winRate:63,rrMin:3,rrMax:6,color:'#ffd700',tags:['Breaker Block','Mitigation','Support/Resistance Flip'],conditions:['Locate a prior Order Block that price has already broken through (failed OB) â€” this becomes a Breaker Block','The break through the OB must be decisive â€” full candle body close beyond the OB','Mark the breaker zone: for a bullish breaker (failed bear OB) = prior OB top becomes new support; for bearish breaker (failed bull OB) = prior OB bottom becomes new resistance','Price must return to the breaker zone from the opposite side (mitigation)','Entry on touch of the breaker zone with a bearish/bullish rejection candle (pin bar, engulf)','Breaker must be in Premium zone (shorts) or Discount zone (longs) of the larger swing range'],entry:'At the breaker zone level, confirmed by rejection candle',sl:'Beyond the breaker block body (not just the wick)',tp:'Next OB on HTF, opposing liquidity pool. Scale 50% at 1:3, remainder to 1:5+',desc:'When an OB fails, smart money has left that zone. When price returns to mitigate, residual orders are filled at the flip zone. The polarity flip from support to resistance (or vice versa) is a consistent institutional behavior pattern observable across all timeframes.'},
  {id:5,name:'Market Structure Shift + OTE Fibonacci',short:'MSS + OTE Fibonacci',winRate:71,rrMin:4,rrMax:12,color:'#cc88ff',tags:['MSS','OTE','Multi-Timeframe','Fibonacci'],conditions:['Higher Timeframe (1H+) trend clearly defined by series of higher highs / lower lows','15m shows a Market Structure Shift (MSS): first break counter to HTF trend, then resumption','The displacement leg that creates the MSS forms a new Order Block on the 15m chart','Draw Fibonacci from the swing low to high (bull) or high to low (bear) of the MSS displacement leg','Optimal Trade Entry (OTE) zone = 61.8% to 78.6% Fibonacci retracement â€” this is where limit orders sit','Price must reach OTE and show a candle close back in the trend direction (wicks into OTE are fine, body must close back)'],entry:'Limit order at 70.5% Fibonacci (midpoint of OTE zone 61.8â€“78.6%)',sl:'Below/above the 0% Fibonacci level (beyond the MSS origin swing)',tp:'1.272Ã— and 1.618Ã— Fibonacci extensions. 1:4 minimum, often achieves 1:8-12.',desc:'The ICT "gold standard" â€” using HTF bias confirmed by 15m MSS, then entering at the precise OTE zone where institutional limit orders are placed. This multi-timeframe confluence produces the highest R:R trades. The OTE zone is derived from Fibonacci, which maps to institutional order clusters.'},
  {id:6,name:'Higher Lows Sweep â†’ Displacement + OB/FVG Entry (Custom)',short:'HL Sweep â†’ OB/FVG Entry',winRate:69,rrMin:3,rrMax:9,color:'#ff6699',tags:['Higher Lows','Liquidity Sweep','Displacement','OB','FVG','Custom'],conditions:['A series of at least 3 ascending structural Higher Lows must form â€” each HL clearly higher than the previous','Price sweeps BELOW at least 2 of these Higher Lows â€” clearing layered stop-loss orders','A strong bullish DISPLACEMENT candle fires up and closes ABOVE the last major swing high (MSS/BOS confirmed)','Entry at 50% of the OB+FVG of the displacement move â€” the institutional order zone of that impulse','Stop Loss below the lowest wick of the sweep candles â€” full sweep invalidation level','Target: the last major swing high that was broken by the displacement candle'],entry:'50% of OB body OR 50% of FVG (whichever is present) of the displacement candle',sl:'Below the deepest sweep wick â€” below all swept Higher Lows',tp:'The last swing high broken by the displacement candle. Often 1:4â€“1:9 R:R.',desc:'Your custom pattern: institutions sweep stops below a series of Higher Lows (collecting fuel), then fire a powerful displacement candle that breaks the last swing high. The OB/FVG of that displacement is the entry zone. This is not just a sweep â€” the displacement that follows and breaks structure is the confirmation the move is real.'}
];

let allAlerts=[], mcapSyms=[], volSyms=[], gainerSyms=[], allMarketData={};
let wTabActive='mcap', filters={tf:'ALL',dir:'ALL',strat:'ALL'};
let soundOn=true, audioCtx=null, newCount=0;
let stratEnabled={1:true,2:true,3:true,4:true,5:true,6:true};
let cdSeconds=300, cdInterval=null;
const BINANCE='https://api.binance.com/api/v3';

// â”€â”€ FETCHING â”€â”€
async function fetchAllTickers(){
  try{
    const r=await fetch('https://api.binance.com/api/v3/ticker/24hr');
    if(!r.ok) return null;
    const data=await r.json();
    const usdt=data.filter(t=>t.symbol.endsWith('USDT')&&!['UP','DOWN','BULL','BEAR'].some(x=>t.symbol.includes(x))&&parseFloat(t.lastPrice)>0&&parseFloat(t.quoteVolume)>500000);
    allMarketData={};
    usdt.forEach(t=>{allMarketData[t.symbol]=t;});
    return usdt;
  }catch(e){return null;}
}

async function refreshSymbolLists(){
  const usdt=await fetchAllTickers();
  if(!usdt) return;
  const MCAP=['BTCUSDT','ETHUSDT','BNBUSDT','SOLUSDT','XRPUSDT','DOGEUSDT','ADAUSDT','AVAXUSDT','LINKUSDT','DOTUSDT','MATICUSDT','LTCUSDT','SHIBUSDT','TRXUSDT','ATOMUSDT','UNIUSDT','XLMUSDT','ETCUSDT','NEARUSDT','AAVEUSDT'];
  mcapSyms=MCAP.filter(s=>allMarketData[s]).slice(0,20);
  volSyms=[...usdt].sort((a,b)=>parseFloat(b.quoteVolume)-parseFloat(a.quoteVolume)).slice(0,20).map(t=>t.symbol);
  gainerSyms=[...usdt].filter(t=>parseFloat(t.priceChangePercent)>0).sort((a,b)=>parseFloat(b.priceChangePercent)-parseFloat(a.priceChangePercent)).slice(0,20).map(t=>t.symbol);
  const el=document.getElementById('setSymCount');
  if(el) el.textContent=[...new Set([...mcapSyms,...volSyms,...gainerSyms])].length+' unique';
  renderWatchlist();
}

async function fetchKlines(symbol,interval,limit=150){
  try{
    const r=await fetch(`${BINANCE}/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`);
    if(!r.ok) return null;
    const data=await r.json();
    return data.map(k=>({t:+k[0],o:+k[1],h:+k[2],l:+k[3],c:+k[4],v:+k[5]}));
  }catch(e){return null;}
}

// â”€â”€ MATH HELPERS â”€â”€
function atr(klines,p=14){
  let s=0,n=Math.min(p,klines.length-1);
  for(let i=klines.length-n;i<klines.length;i++){
    const pr=klines[i-1],c=klines[i];
    s+=Math.max(c.h-c.l,Math.abs(c.h-pr.c),Math.abs(c.l-pr.c));
  }
  return s/n;
}
function avgVol(klines,p=20){const n=Math.min(p,klines.length);return klines.slice(-n).reduce((s,k)=>s+k.v,0)/n;}
function candleSize(k){return Math.abs(k.c-k.o);}
function isBull(k){return k.c>k.o;}
function isBear(k){return k.c<k.o;}

function swingHighs(klines,lookback=3){
  const res=[];
  for(let i=lookback;i<klines.length-lookback;i++){
    const h=klines[i].h;let ok=true;
    for(let j=1;j<=lookback;j++){if(klines[i-j].h>=h||klines[i+j].h>=h){ok=false;break;}}
    if(ok) res.push({i,h,l:klines[i].l,c:klines[i]});
  }
  return res;
}
function swingLows(klines,lookback=3){
  const res=[];
  for(let i=lookback;i<klines.length-lookback;i++){
    const l=klines[i].l;let ok=true;
    for(let j=1;j<=lookback;j++){if(klines[i-j].l<=l||klines[i+j].l<=l){ok=false;break;}}
    if(ok) res.push({i,l,h:klines[i].h,c:klines[i]});
  }
  return res;
}

function fmtP(p){
  if(!p||isNaN(p)) return 'â€”';
  if(p>=10000) return p.toLocaleString('en',{minimumFractionDigits:1,maximumFractionDigits:1});
  if(p>=100) return p.toFixed(2);
  if(p>=1) return p.toFixed(4);
  if(p>=0.01) return p.toFixed(5);
  return p.toFixed(7);
}
function fmtT(d){return new Date(d).toLocaleTimeString('en',{hour:'2-digit',minute:'2-digit',second:'2-digit'});}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIX 3A â€” S1: OB + BOS  (price must be AT the zone right now)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function s1_OB_BOS(klines,sym,tf){
  const A=atr(klines), avgV=avgVol(klines);
  const N=klines.length, cur=klines[N-1].c;
  // scan last 60 bars for a valid OB that had a BOS after it
  for(let i=Math.max(5,N-60);i<N-4;i++){
    const k=klines[i];
    // BULLISH OB: bearish candle â†’ bullish impulse breaks prior swing high
    if(isBear(k)){
      let top=k.c, iend=i;
      for(let j=i+1;j<Math.min(i+8,N);j++){if(klines[j].h>top){top=klines[j].h;iend=j;}}
      if(top-k.l<A*1.5) continue;
      const prH=klines.slice(Math.max(0,i-20),i).reduce((m,c)=>Math.max(m,c.h),-Infinity);
      if(top<=prH) continue;
      if(klines[i+1]&&klines[i+1].v<avgV*0.9) continue;
      if(iend>=N-3) continue; // OB must be old enough
      const obTop=Math.max(k.o,k.c), obBot=Math.min(k.o,k.c);
      // Current price must be inside or touching the OB zone (Â±0.5%)
      if(cur>obTop*1.005||cur<obBot*0.995) continue;
      const entry=(obTop+obBot)/2, sl=obBot-A*0.5;
      if(sl<=0||entry<=sl) continue;
      const tp1=entry+(entry-sl)*3.5, tp2=entry+(entry-sl)*6, rr=(tp1-entry)/(entry-sl);
      if(rr>=3) return [makeAlert(sym,tf,1,'LONG',cur,entry,sl,tp1,tp2,rr,klines,i)];
    }
    // BEARISH OB: bullish candle â†’ bearish impulse breaks prior swing low
    if(isBull(k)){
      let bot=k.c, iend=i;
      for(let j=i+1;j<Math.min(i+8,N);j++){if(klines[j].l<bot){bot=klines[j].l;iend=j;}}
      if(k.h-bot<A*1.5) continue;
      const prL=klines.slice(Math.max(0,i-20),i).reduce((m,c)=>Math.min(m,c.l),Infinity);
      if(bot>=prL) continue;
      if(klines[i+1]&&klines[i+1].v<avgV*0.9) continue;
      if(iend>=N-3) continue;
      const obTop=Math.max(k.o,k.c), obBot=Math.min(k.o,k.c);
      if(cur<obBot*0.995||cur>obTop*1.005) continue;
      const entry=(obTop+obBot)/2, sl=obTop+A*0.5;
      if(entry>=sl) continue;
      const tp1=entry-(sl-entry)*3.5, tp2=entry-(sl-entry)*6, rr=(entry-tp1)/(sl-entry);
      if(rr>=3) return [makeAlert(sym,tf,1,'SHORT',cur,entry,sl,tp1,tp2,rr,klines,i)];
    }
  }
  return [];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIX 3B â€” S2: FVG + CHoCH  (price must be retesting FVG now)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function s2_FVG_CHoCH(klines,sym,tf){
  const A=atr(klines);
  const N=klines.length, cur=klines[N-1].c;
  for(let i=Math.max(5,N-60);i<N-4;i++){
    const k=klines[i];
    // BULL CHoCH: strong bull candle breaks above recent LH structure
    if(isBull(k)&&candleSize(k)>=A*0.7){
      const seg=klines.slice(Math.max(0,i-15),i);
      const sls=swingLows(seg,2);
      if(sls.length<2) continue;
      if(sls[sls.length-1].l>=sls[sls.length-2].l) continue; // need lower lows before
      // FVG: gap between k-1 high and k+1 low
      const kp=klines[i-1], kn=klines[i+1];
      if(!kp||!kn) continue;
      const fvgBot=kp.h, fvgTop=kn.l;
      if(fvgTop<=fvgBot||(fvgTop-fvgBot)<A*0.15) continue;
      if(i>=N-3) continue;
      // Current price must be in FVG zone
      if(cur>fvgTop*1.003||cur<fvgBot*0.997) continue;
      const entry=(fvgBot+fvgTop)/2, sl=fvgBot-A*0.5;
      if(sl<=0||entry<=sl) continue;
      const tp1=entry+(entry-sl)*3.5, tp2=entry+(entry-sl)*6, rr=(tp1-entry)/(entry-sl);
      if(rr>=3) return [makeAlert(sym,tf,2,'LONG',cur,entry,sl,tp1,tp2,rr,klines,i)];
    }
    // BEAR CHoCH: strong bear candle breaks below recent HL structure
    if(isBear(k)&&candleSize(k)>=A*0.7){
      const seg=klines.slice(Math.max(0,i-15),i);
      const shs=swingHighs(seg,2);
      if(shs.length<2) continue;
      if(shs[shs.length-1].h<=shs[shs.length-2].h) continue;
      const kp=klines[i-1], kn=klines[i+1];
      if(!kp||!kn) continue;
      const fvgTop=kp.l, fvgBot=kn.h;
      if(fvgBot>=fvgTop||(fvgTop-fvgBot)<A*0.15) continue;
      if(i>=N-3) continue;
      if(cur<fvgBot*0.997||cur>fvgTop*1.003) continue;
      const entry=(fvgBot+fvgTop)/2, sl=fvgTop+A*0.5;
      if(entry>=sl) continue;
      const tp1=entry-(sl-entry)*3.5, tp2=entry-(sl-entry)*6, rr=(entry-tp1)/(sl-entry);
      if(rr>=3) return [makeAlert(sym,tf,2,'SHORT',cur,entry,sl,tp1,tp2,rr,klines,i)];
    }
  }
  return [];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIX 3C â€” S3: Liquidity Sweep  (only fires for very recent sweeps)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function s3_LiqSweep(klines,sym,tf){
  const A=atr(klines);
  const N=klines.length, cur=klines[N-1].c;
  // Only check last 5 candles for the sweep event
  for(let i=Math.max(8,N-5);i<N-1;i++){
    const sw=klines[i];
    const prior=klines.slice(Math.max(0,i-30),i);
    // BULL SWEEP: equal lows swept, close back above
    const minL=prior.reduce((m,c)=>Math.min(m,c.l),Infinity);
    const eqLows=prior.filter(c=>Math.abs(c.l-minL)/minL<0.004).length;
    if(eqLows>=2&&sw.l<minL&&sw.c>minL&&(minL-sw.l)>=A*0.3){
      const nk=klines[i+1];
      if(nk&&(isBull(nk)||nk.c>sw.c)){
        const entry=cur, sl=sw.l-A*0.2;
        if(sl<=0||entry<=sl) continue;
        const priorHigh=prior.reduce((m,c)=>Math.max(m,c.h),-Infinity);
        const tp1=Math.max(priorHigh,entry+(entry-sl)*3);
        const tp2=entry+(entry-sl)*6, rr=(tp1-entry)/(entry-sl);
        if(rr>=3) return [makeAlert(sym,tf,3,'LONG',cur,entry,sl,tp1,tp2,rr,klines,i)];
      }
    }
    // BEAR SWEEP: equal highs swept, close back below
    const maxH=prior.reduce((m,c)=>Math.max(m,c.h),-Infinity);
    const eqHighs=prior.filter(c=>Math.abs(c.h-maxH)/maxH<0.004).length;
    if(eqHighs>=2&&sw.h>maxH&&sw.c<maxH&&(sw.h-maxH)>=A*0.3){
      const nk=klines[i+1];
      if(nk&&(isBear(nk)||nk.c<sw.c)){
        const entry=cur, sl=sw.h+A*0.2;
        if(entry>=sl) continue;
        const priorLow=prior.reduce((m,c)=>Math.min(m,c.l),Infinity);
        const tp1=Math.min(priorLow,entry-(sl-entry)*3);
        const tp2=entry-(sl-entry)*6, rr=(entry-tp1)/(sl-entry);
        if(rr>=3) return [makeAlert(sym,tf,3,'SHORT',cur,entry,sl,tp1,tp2,rr,klines,i)];
      }
    }
  }
  return [];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIX 3D â€” S4: Breaker Block  (price must be AT the breaker zone)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function s4_Breaker(klines,sym,tf){
  const A=atr(klines);
  const N=klines.length, cur=klines[N-1].c;
  for(let i=Math.max(5,N-80);i<N-10;i++){
    const k=klines[i];
    // BULLISH BREAKER: bull OB broken down â†’ flip to resistance, now price retests from above
    if(isBull(k)){
      const obTop=Math.max(k.o,k.c), obBot=Math.min(k.o,k.c);
      // Confirm bear impulse after this candle (it was an OB)
      let hadImp=false;
      for(let j=i+1;j<Math.min(i+5,N);j++){if(isBear(klines[j])&&candleSize(klines[j])>A*0.7){hadImp=true;break;}}
      if(!hadImp) continue;
      // Price must have broken UP through obTop (making it a bullish breaker)
      let brkIdx=-1;
      for(let j=i+5;j<Math.min(i+40,N);j++){if(klines[j].c>obTop&&isBull(klines[j])){brkIdx=j;break;}}
      if(brkIdx<0||brkIdx>=N-3) continue;
      // Current price retesting obTop from above (Â±0.6%)
      if(cur<obTop*0.994||cur>obTop*1.006) continue;
      const entry=obTop, sl=obBot-A*0.3;
      if(sl<=0||entry<=sl) continue;
      const tp1=entry+(entry-sl)*3, tp2=entry+(entry-sl)*5, rr=(tp1-entry)/(entry-sl);
      if(rr>=3) return [makeAlert(sym,tf,4,'LONG',cur,entry,sl,tp1,tp2,rr,klines,i)];
    }
    // BEARISH BREAKER: bear OB broken up â†’ flip to support, now price retests from below
    if(isBear(k)){
      const obTop=Math.max(k.o,k.c), obBot=Math.min(k.o,k.c);
      let hadImp=false;
      for(let j=i+1;j<Math.min(i+5,N);j++){if(isBull(klines[j])&&candleSize(klines[j])>A*0.7){hadImp=true;break;}}
      if(!hadImp) continue;
      let brkIdx=-1;
      for(let j=i+5;j<Math.min(i+40,N);j++){if(klines[j].c<obBot&&isBear(klines[j])){brkIdx=j;break;}}
      if(brkIdx<0||brkIdx>=N-3) continue;
      if(cur>obBot*1.006||cur<obBot*0.994) continue;
      const entry=obBot, sl=obTop+A*0.3;
      if(entry>=sl) continue;
      const tp1=entry-(sl-entry)*3, tp2=entry-(sl-entry)*5, rr=(entry-tp1)/(sl-entry);
      if(rr>=3) return [makeAlert(sym,tf,4,'SHORT',cur,entry,sl,tp1,tp2,rr,klines,i)];
    }
  }
  return [];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIX 3E â€” S5: MSS + OTE  (current price must be in OTE zone)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function s5_MSS_OTE(klines,sym,tf){
  const A=atr(klines);
  const N=klines.length, cur=klines[N-1].c;
  // Determine trend from last 60 candles
  const htf=klines.slice(-60);
  const hSH=swingHighs(htf,4), hSL=swingLows(htf,4);
  const bull=hSH.length>=2&&hSL.length>=2&&hSH[hSH.length-1].h>hSH[hSH.length-2].h&&hSL[hSL.length-1].l>hSL[hSL.length-2].l;
  const bear=hSH.length>=2&&hSL.length>=2&&hSH[hSH.length-1].h<hSH[hSH.length-2].h&&hSL[hSL.length-1].l<hSL[hSL.length-2].l;
  if(!bull&&!bear) return [];
  // Find MSS displacement in last 30 candles
  const rec=klines.slice(-30);
  for(let i=4;i<rec.length-1;i++){
    const d=rec[i];
    if(bull&&isBull(d)&&candleSize(d)>=A*0.7){
      const swL=rec.slice(0,i).reduce((m,c)=>Math.min(m,c.l),Infinity);
      const swH=d.h;
      if(swH<=swL) continue;
      const rng=swH-swL;
      const ote618=swH-rng*0.618, ote786=swH-rng*0.786;
      if(cur>=ote786*0.999&&cur<=ote618*1.001){
        const entry=(ote618+ote786)/2, sl=swL-A*0.3;
        if(sl<=0||entry<=sl) continue;
        const tp1=swH+rng*0.272, tp2=swH+rng*0.618, rr=(tp1-entry)/(entry-sl);
        if(rr>=4) return [makeAlert(sym,tf,5,'LONG',cur,entry,sl,tp1,tp2,rr,klines,N-30+i)];
      }
    }
    if(bear&&isBear(d)&&candleSize(d)>=A*0.7){
      const swH=rec.slice(0,i).reduce((m,c)=>Math.max(m,c.h),-Infinity);
      const swL=d.l;
      if(swH<=swL) continue;
      const rng=swH-swL;
      const ote618=swL+rng*0.618, ote786=swL+rng*0.786;
      if(cur>=ote618*0.999&&cur<=ote786*1.001){
        const entry=(ote618+ote786)/2, sl=swH+A*0.3;
        if(entry>=sl) continue;
        const tp1=swL-rng*0.272, tp2=swL-rng*0.618, rr=(entry-tp1)/(sl-entry);
        if(rr>=4) return [makeAlert(sym,tf,5,'SHORT',cur,entry,sl,tp1,tp2,rr,klines,N-30+i)];
      }
    }
  }
  return [];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIX 3F â€” S6: HL Sweep â†’ Displacement â†’ OB/FVG Entry (YOUR EXACT SPEC)
// 1. â‰¥3 structural Higher Lows
// 2. â‰¥2 HLs swept
// 3. Strong bullish displacement CLOSES ABOVE last swing high (MSS/BOS)
// 4. Entry = 50% of OB+FVG of that displacement
// 5. SL = below lowest sweep wick
// 6. TP = the swing high that was broken
// Current price must be near the entry zone
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function s6_HL_Sweep(klines,sym,tf){
  const A=atr(klines);
  const N=klines.length, cur=klines[N-1].c;
  const lookback=Math.min(100,N-5);
  const slice=klines.slice(N-lookback);
  const L=slice.length;

  // Step 1: Find ascending Higher Lows (min 3 pivots)
  const pLows=swingLows(slice,3);
  if(pLows.length<3) return [];
  let best=[];
  for(let s=0;s<pLows.length-2;s++){
    let seq=[pLows[s]];
    for(let j=s+1;j<pLows.length;j++){if(pLows[j].l>seq[seq.length-1].l&&pLows[j].i>seq[seq.length-1].i) seq.push(pLows[j]);}
    if(seq.length>best.length) best=seq;
  }
  if(best.length<3) return [];

  // Step 2: The last major swing high BEFORE the HL structure = TP target
  const firstHLi=best[0].i;
  const beforeHL=slice.slice(0,firstHLi+5);
  const prevSH=swingHighs(beforeHL,3);
  const betweenHL=slice.slice(firstHLi,best[best.length-1].i+1);
  const betHigh=betweenHL.reduce((m,c)=>Math.max(m,c.h),-Infinity);
  const lastMajorHigh=Math.max(prevSH.length?prevSH[prevSH.length-1].h:0, betHigh);
  if(!lastMajorHigh||isNaN(lastMajorHigh)||lastMajorHigh<=0) return [];

  // Step 3: Count swept HLs â€” wick below the HL level
  const secondLast=best[best.length-2];
  let sweepWickLow=Infinity, sweepCandleIdx=-1, sweptCount=0;
  for(let i=secondLast.i;i<L;i++){
    const c=slice[i];
    const sweptNow=best.filter(h=>i>h.i&&c.l<h.l).length;
    if(sweptNow>sweptCount) sweptCount=sweptNow;
    if(c.l<secondLast.l&&c.l<sweepWickLow){sweepWickLow=c.l;sweepCandleIdx=i;}
  }
  if(sweptCount<2||sweepCandleIdx<0||sweepWickLow===Infinity) return [];

  // Step 4: Find bullish displacement candle AFTER the sweep that CLOSES ABOVE lastMajorHigh
  let dispIdx=-1, dispCandle=null;
  for(let i=sweepCandleIdx+1;i<L;i++){
    const c=slice[i];
    if(isBull(c)&&c.c>lastMajorHigh&&candleSize(c)>=A*0.7){dispIdx=i;dispCandle=c;break;}
  }
  if(dispIdx<0||!dispCandle) return [];

  // Step 5: Displacement must be recent (within last 10 candles of full klines)
  const actualDispIdx=N-lookback+dispIdx;
  if(actualDispIdx<N-10) return [];

  // Step 6: OB of displacement = last bear candle before the displacement
  let obTop=dispCandle.o, obBot=dispCandle.o; // fallback: use open of disp
  for(let i=dispIdx-1;i>=Math.max(0,dispIdx-5);i--){
    if(isBear(slice[i])){obTop=Math.max(slice[i].o,slice[i].c);obBot=Math.min(slice[i].o,slice[i].c);break;}
  }
  // FVG of displacement = gap between disp[i-1] high and disp[i+1] low
  let fvgTop=null,fvgBot=null;
  const dp=slice[dispIdx-1],dn=dispIdx+1<L?slice[dispIdx+1]:null;
  if(dp&&dn&&dn.l>dp.h&&(dn.l-dp.h)>=A*0.1){fvgTop=dn.l;fvgBot=dp.h;}

  // Entry zone = 50% of FVG (preferred) or 50% of OB
  let ezTop,ezBot;
  if(fvgBot&&fvgTop){ezTop=fvgTop;ezBot=fvgBot;}
  else{ezTop=obTop;ezBot=obBot;}
  // Safety: if zone is nonsense, use displacement body 50%
  if(ezTop<=ezBot||isNaN(ezTop)||isNaN(ezBot)){ezTop=Math.max(dispCandle.o,dispCandle.c);ezBot=Math.min(dispCandle.o,dispCandle.c);}

  const entry=(ezTop+ezBot)/2;
  const sl=sweepWickLow-A*0.25;
  const tp1=lastMajorHigh;
  const tp2=lastMajorHigh+(lastMajorHigh-entry)*0.5;
  if(sl<=0||isNaN(sl)||entry<=sl) return [];
  const dist=entry-sl;
  if(dist<=0) return [];
  const rr=(tp1-entry)/dist;
  if(rr<2.5) return [];

  // Step 7: Current price must be near or inside the entry zone (price is pulling back to the zone)
  const inZone=cur>=sl*1.001&&cur<=ezTop*1.01;
  if(!inZone) return [];

  const al=makeAlert(sym,tf,6,'LONG',cur,entry,sl,tp1,tp2,rr,klines,actualDispIdx);
  al.hlLevels=best.map(h=>h.l);
  al.sweepLow=sweepWickLow;
  al.majorHigh=lastMajorHigh;
  al.explanation=`${sym.replace('USDT','')} on ${tf}: ${best.length} ascending Higher Lows formed a structural HL sequence. Institutions swept below ${sweptCount} of those HLs (deepest wick: $${fmtP(sweepWickLow)}), clearing stop-loss orders. A strong bullish displacement then closed ABOVE the last swing high ($${fmtP(lastMajorHigh)}) â€” confirming Market Structure Shift. Entry at 50% of the ${fvgBot&&fvgTop?'FVG':'OB'} of the displacement move at $${fmtP(entry)}. SL at $${fmtP(sl)} (below sweep low). TP at broken swing high $${fmtP(tp1)} â€” ${rr.toFixed(1)}:1 R:R.`;
  return [al];
}

// â”€â”€ ALERT BUILDER â”€â”€
function makeAlert(sym,tf,sid,dir,price,entry,sl,tp1,tp2,rr,klines,sigIdx){
  const s=STRATS[sid-1];
  const sliceLen=65, start=Math.max(0,klines.length-sliceLen);
  const candleSlice=klines.slice(start);
  const tp3=dir==='LONG'?tp1+(tp1-entry)*0.6:tp1-(entry-tp1)*0.6;
  return {
    id:`${sym}-${tf}-${sid}-${dir}-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,
    sym,tf,sid,dir,stratName:s.short,
    price:fmtP(price),priceNum:price,
    entry:fmtP(entry),entryNum:entry,
    sl:fmtP(sl),slNum:sl,
    tp1:fmtP(tp1),tp1Num:tp1,
    tp2:fmtP(tp2),tp2Num:tp2,
    tp3:fmtP(tp3),tp3Num:tp3,
    rr:rr.toFixed(1),rrNum:rr,
    winRate:s.winRate,color:s.color,
    time:Date.now(),candles:candleSlice,
    sigIdx:sigIdx-start,
    explanation:buildExp(sid,sym,tf,dir,entry,sl,tp1,rr)
  };
}

function buildExp(sid,sym,tf,dir,entry,sl,tp1,rr){
  const s=sym.replace('USDT',''),d=dir==='LONG';
  const e={
    1:`${s} on ${tf}: A valid ${d?'bullish':'bearish'} Order Block identified â€” the last ${d?'bearish':'bullish'} candle before a strong structural impulse. Price has returned to retest this OB at $${fmtP(entry)} after the BOS. Entry at OB midpoint, SL ${d?'below':'above'} OB + ATR buffer. TP at $${fmtP(tp1)} â€” ${rr.toFixed(1)}:1 R:R.`,
    2:`${s} on ${tf}: Change of Character (CHoCH) confirmed â€” first structural break ${d?'upward':'downward'}. The displacement left a Fair Value Gap which price is now retesting. FVG equilibrium at $${fmtP(entry)}. SL beyond CHoCH origin. TP $${fmtP(tp1)} â€” ${rr.toFixed(1)}:1 R:R.`,
    3:`${s} on ${tf}: ${d?'Bullish':'Bearish'} liquidity sweep â€” equal ${d?'lows':'highs'} wicked through then price closed back ${d?'above':'below'}. Stop hunt confirmed. Entry $${fmtP(entry)}, SL beyond sweep wick. TP $${fmtP(tp1)} â€” ${rr.toFixed(1)}:1 R:R.`,
    4:`${s} on ${tf}: Breaker Block â€” prior ${d?'bearish':'bullish'} OB broke through, flipping polarity to ${d?'support':'resistance'}. Price retesting the flip zone at $${fmtP(entry)}. SL beyond the block. TP $${fmtP(tp1)} â€” ${rr.toFixed(1)}:1 R:R.`,
    5:`${s} on ${tf}: HTF ${d?'bullish':'bearish'} trend confirmed. MSS displacement created an OTE Fibonacci zone (61.8â€“78.6%). Price is now in the OTE at $${fmtP(entry)}. SL beyond MSS origin. TP $${fmtP(tp1)} â€” ${rr.toFixed(1)}:1 R:R.`
  };
  return e[sid]||'';
}

// â”€â”€ SCAN ENGINE â”€â”€
let scanning=false;
async function runScan(){
  if(scanning) return;
  scanning=true; setScanStatus('SCANNING','#ff8800');
  try{
    await refreshSymbolLists();
    const universe=[...new Set([...mcapSyms,...volSyms,...gainerSyms])];
    const el=document.getElementById('stSyms');if(el)el.textContent=universe.length;
    const fns=[s1_OB_BOS,s2_FVG_CHoCH,s3_LiqSweep,s4_Breaker,s5_MSS_OTE,s6_HL_Sweep];
    const minRR=parseFloat(document.getElementById('minRRIn')?.value)||3;
    for(const sym of universe){
      for(const tf of ['15m','1h']){
        const klines=await fetchKlines(sym,tf);
        if(!klines||klines.length<50) continue;
        for(let si=0;si<fns.length;si++){
          if(!stratEnabled[si+1]) continue;
          try{
            const found=fns[si](klines,sym,tf);
            for(const a of found){
              if(parseFloat(a.rr)<minRR) continue;
              const dup=allAlerts.some(e=>e.sym===a.sym&&e.tf===a.tf&&e.sid===a.sid&&e.dir===a.dir&&(Date.now()-e.time)<8*60*1000);
              if(!dup){allAlerts.unshift(a);newCount++;showToast(a);playSound(a.dir);pushNotif(a);}
            }
          }catch(e){}
        }
      }
      await new Promise(r=>setTimeout(r,0));
    }
  }catch(e){console.error('Scan:',e);}
  allAlerts=allAlerts.slice(0,120);
  scanning=false; setScanStatus('LIVE','#00ff88');
  renderAlerts(); updateStats(); resetCountdown();
}

function setScanStatus(t,c){
  document.getElementById('sTxt').textContent=t;
  document.getElementById('sDot').style.background=c;
  document.getElementById('sDot').style.boxShadow=`0 0 8px ${c}`;
}
function forceScan(){resetCountdown();runScan();}
function resetCountdown(){cdSeconds=(parseInt(document.getElementById('scanMins')?.value)||5)*60;}
function tickCountdown(){
  cdSeconds=Math.max(0,cdSeconds-1);
  const m=Math.floor(cdSeconds/60),s=cdSeconds%60;
  document.getElementById('cdTimer').textContent=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  if(cdSeconds===0&&document.getElementById('autoTog')?.classList.contains('on')) runScan();
  else if(cdSeconds===0) resetCountdown();
}

// â”€â”€ WATCHLIST â”€â”€
function renderWatchlist(){
  const syms=wTabActive==='mcap'?mcapSyms:wTabActive==='vol'?volSyms:gainerSyms;
  const grid=document.getElementById('wGrid');
  if(!syms.length){grid.innerHTML='<div style="font-family:var(--mono);font-size:10px;color:var(--text3);padding:10px;">Loadingâ€¦</div>';return;}
  grid.innerHTML=syms.slice(0,20).map(sym=>{
    const d=allMarketData[sym];if(!d) return '';
    const short=sym.replace('USDT',''),chg=parseFloat(d.priceChangePercent);
    return `<div class="witem" onclick="quickSearch('${short}')"><div class="wsym">${short}</div><div class="wprice">$${fmtP(parseFloat(d.lastPrice))}</div><div class="wchg ${chg>=0?'up':'dn'}">${chg>=0?'+':''}${chg.toFixed(2)}%</div></div>`;
  }).join('');
}
function switchWTab(el,tab){wTabActive=tab;document.querySelectorAll('.wtab').forEach(t=>t.classList.remove('active'));el.classList.add('active');renderWatchlist();}
function quickSearch(sym){document.getElementById('searchIn').value=sym;renderAlerts();}

// â”€â”€ ALERTS RENDER â”€â”€
function getFiltered(){
  const search=document.getElementById('searchIn').value.toLowerCase();
  const strat=document.getElementById('stratSel').value;
  return allAlerts.filter(a=>{
    if(filters.tf!=='ALL'&&a.tf!==filters.tf) return false;
    if(filters.dir!=='ALL'&&a.dir!==filters.dir) return false;
    if(strat!=='ALL'&&a.sid!==parseInt(strat)) return false;
    if(search&&!a.sym.toLowerCase().includes(search)) return false;
    return true;
  });
}
function renderAlerts(){
  const f=getFiltered();
  const list=document.getElementById('alertsList');
  document.getElementById('acTxt').textContent=`${f.length} alerts`;
  if(!f.length){list.innerHTML=`<div class="empty"><div class="ei">ğŸ“¡</div><h3>No matching setups</h3><p>Adjust filters or wait for next scan</p></div>`;return;}
  list.innerHTML=f.map((a,idx)=>{
    const short=a.sym.replace('USDT',''),isNew=(Date.now()-a.time)<60000;
    return `<div class="arow ${a.dir.toLowerCase()} ${isNew?'fresh':''}" onclick="openModal('${a.id}')">
      <div class="asymbol">${short}</div>
      <div class="astrat" title="S${a.sid}: ${STRATS[a.sid-1].name}">S${a.sid}: ${a.stratName}</div>
      <div class="atf"><span style="background:var(--bg3);border:1px solid var(--border);border-radius:3px;padding:2px 7px;font-family:var(--mono);font-size:9px;">${a.tf}</span></div>
      <div class="adir ${a.dir.toLowerCase()}">${a.dir==='LONG'?'â–² LONG':'â–¼ SHORT'}</div>
      <div class="aprice">$${a.entry}</div>
      <div class="arr">1:${a.rr}</div>
      <div class="awr">${a.winRate}%</div>
      <div class="atime">${fmtT(a.time)}</div>
      <canvas class="achrt" id="mc${idx}" width="130" height="46"></canvas>
      <div class="aarr">â€º</div>
    </div>`;
  }).join('');
  f.forEach((a,idx)=>{const c=document.getElementById(`mc${idx}`);if(c) drawMini(c,a.candles,a.dir,a.entryNum,a.slNum,a.tp1Num);});
  updateStats();
}
function updateStats(){
  document.getElementById('stTotal').textContent=allAlerts.length;
  document.getElementById('stLong').textContent=allAlerts.filter(a=>a.dir==='LONG').length;
  document.getElementById('stShort').textContent=allAlerts.filter(a=>a.dir==='SHORT').length;
  const avg=allAlerts.length?(allAlerts.reduce((s,a)=>s+parseFloat(a.rr),0)/allAlerts.length).toFixed(1):'â€”';
  document.getElementById('stRR').textContent=allAlerts.length?`1:${avg}`:'â€”';
  document.getElementById('newBadge').textContent=`${newCount} NEW`;
}
function setFilter(type,val,btn){
  if(type==='strat') val=document.getElementById('stratSel').value;
  else filters[type]=val;
  if(btn){const par=btn.parentElement;par.querySelectorAll('.fb').forEach(b=>b.classList.remove('active'));btn.classList.add('active');}
  renderAlerts();
}
function clearAlerts(){allAlerts=[];newCount=0;renderAlerts();updateStats();}

// â”€â”€ MINI CHART â”€â”€
function drawMini(canvas,candles,dir,entry,sl,tp1){
  const ctx=canvas.getContext('2d'),W=canvas.width,H=canvas.height;
  if(!candles||!candles.length){ctx.fillStyle='#090d1a';ctx.fillRect(0,0,W,H);return;}
  const sl2=candles.slice(-30);
  const ps=sl2.flatMap(c=>[c.h,c.l]);
  const extras=[entry,sl,tp1].filter(v=>v&&!isNaN(v));
  const mn=Math.min(...ps,...extras)-Math.abs(Math.min(...ps,...extras))*0.005;
  const mx=Math.max(...ps,...extras)+Math.abs(Math.max(...ps,...extras))*0.005;
  const rng=mx-mn||1;
  const toX=i=>(i/(sl2.length-1))*W, toY=p=>H-((p-mn)/rng)*H;
  ctx.fillStyle='#090d1a';ctx.fillRect(0,0,W,H);
  const cw=Math.max(1.5,(W/sl2.length)*0.65);
  sl2.forEach((c,i)=>{
    const x=toX(i),col=c.c>=c.o?'#00cc6a':'#cc0044';
    ctx.strokeStyle=col;ctx.lineWidth=1;
    ctx.beginPath();ctx.moveTo(x,toY(c.h));ctx.lineTo(x,toY(c.l));ctx.stroke();
    ctx.fillStyle=col;
    const bT=toY(Math.max(c.o,c.c)),bB=toY(Math.min(c.o,c.c));
    ctx.fillRect(x-cw/2,bT,cw,Math.max(1,bB-bT));
  });
  [[entry,'#00d4ff'],[sl,'#ff3366'],[tp1,'#00ff88']].forEach(([p,col])=>{
    if(!p||isNaN(p)||p<mn||p>mx) return;
    ctx.strokeStyle=col;ctx.setLineDash([2,2]);ctx.lineWidth=0.8;
    ctx.beginPath();ctx.moveTo(0,toY(p));ctx.lineTo(W,toY(p));ctx.stroke();ctx.setLineDash([]);
  });
  const lc=sl2[sl2.length-1];
  ctx.fillStyle=dir==='LONG'?'#00ff88':'#ff3366';
  ctx.font='bold 11px sans-serif';
  ctx.fillText(dir==='LONG'?'â†‘':'â†“',W-12,toY(lc.c)+(dir==='LONG'?-3:10));
}

// â”€â”€ MODAL CHART (FIX 1: reliable sizing via offsetWidth after overlay is open) â”€â”€
function drawModal(candles,dir,entry,sl,tp1,tp2,sid,hlLevels,sweepLow){
  const canvas=document.getElementById('mCanvas');
  if(!canvas||!candles||candles.length<3) return;
  const box=document.getElementById('mChrtBox');
  // Use offsetWidth â€” reliable once overlay is visible and we've waited 200ms
  const W=Math.max(300, box?box.offsetWidth:700);
  const H=300;
  canvas.width=W; canvas.height=H;
  const ctx=canvas.getContext('2d');
  ctx.clearRect(0,0,W,H);
  const slice=candles.slice(-80);
  const extras=[entry,sl,tp1,tp2,sweepLow].filter(v=>v&&!isNaN(v));
  const hlExtras=(hlLevels||[]).filter(v=>v&&!isNaN(v));
  const allP=slice.flatMap(c=>[c.h,c.l]).concat(extras,hlExtras);
  if(!allP.length) return;
  const pad=(Math.max(...allP)-Math.min(...allP))*0.1;
  const mn=Math.min(...allP)-pad, mx=Math.max(...allP)+pad, rng=mx-mn||1;
  const LEFT=52,RIGHT=8,TOP=6,BOT=22;
  const toX=i=>LEFT+(i/(slice.length-1||1))*(W-LEFT-RIGHT);
  const toY=p=>TOP+(H-TOP-BOT)-(((p-mn)/rng)*(H-TOP-BOT));
  const bg=ctx.createLinearGradient(0,0,0,H);
  bg.addColorStop(0,'#090d1a');bg.addColorStop(1,'#050810');
  ctx.fillStyle=bg;ctx.fillRect(0,0,W,H);
  ctx.strokeStyle='rgba(30,48,88,0.35)';ctx.lineWidth=0.5;
  for(let i=0;i<=6;i++){
    const y=TOP+(H-TOP-BOT)/6*i,p=mx-(rng/6*i);
    ctx.beginPath();ctx.moveTo(LEFT,y);ctx.lineTo(W-RIGHT,y);ctx.stroke();
    ctx.fillStyle='rgba(68,85,119,0.9)';ctx.font='8px monospace';
    ctx.fillText(fmtP(p),2,y+3);
  }
  ctx.fillStyle='rgba(68,85,119,0.7)';ctx.font='8px monospace';
  [0,20,40,60,slice.length-1].forEach(i=>{
    if(i<slice.length){const x=toX(i),t=new Date(slice[i].t);ctx.fillText(`${String(t.getHours()).padStart(2,'0')}:${String(t.getMinutes()).padStart(2,'0')}`,x-10,H-4);}
  });
  if(hlLevels&&hlLevels.length){
    hlLevels.forEach((lvl,li)=>{
      if(lvl<mn||lvl>mx) return;
      const y=toY(lvl);
      ctx.strokeStyle='rgba(255,102,153,0.5)';ctx.setLineDash([3,5]);ctx.lineWidth=0.9;
      ctx.beginPath();ctx.moveTo(LEFT,y);ctx.lineTo(W-RIGHT,y);ctx.stroke();ctx.setLineDash([]);
      ctx.fillStyle='rgba(255,102,153,0.8)';ctx.font='7px monospace';
      ctx.fillText(`HL${li+1}`,LEFT+2,y-2);
    });
  }
  if(sweepLow&&sweepLow>mn&&sweepLow<mx){
    const y=toY(sweepLow);
    ctx.strokeStyle='rgba(255,51,102,0.6)';ctx.setLineDash([2,4]);ctx.lineWidth=1;
    ctx.beginPath();ctx.moveTo(LEFT,y);ctx.lineTo(W-RIGHT,y);ctx.stroke();ctx.setLineDash([]);
    ctx.fillStyle='rgba(255,51,102,0.9)';ctx.font='7px monospace';ctx.fillText('SWEEP LOW',LEFT+2,y-2);
  }
  if(dir==='LONG'&&entry&&sl&&tp1){
    ctx.fillStyle='rgba(255,51,102,0.05)';const ry=toY(entry),rb=toY(sl);if(rb>ry)ctx.fillRect(LEFT,ry,W-LEFT-RIGHT,rb-ry);
    ctx.fillStyle='rgba(0,255,136,0.05)';const gy=toY(tp1),ge=toY(entry);if(ge>gy)ctx.fillRect(LEFT,gy,W-LEFT-RIGHT,ge-gy);
  }else if(dir==='SHORT'&&entry&&sl&&tp1){
    ctx.fillStyle='rgba(255,51,102,0.05)';const ry=toY(sl),re=toY(entry);if(re>ry)ctx.fillRect(LEFT,ry,W-LEFT-RIGHT,re-ry);
    ctx.fillStyle='rgba(0,255,136,0.05)';const gy=toY(entry),gt=toY(tp1);if(gt>gy)ctx.fillRect(LEFT,gy,W-LEFT-RIGHT,gt-gy);
  }
  const cw=Math.max(2,(W-LEFT-RIGHT)/slice.length*0.6);
  slice.forEach((c,i)=>{
    const x=toX(i),isUp=c.c>=c.o,col=isUp?'#00cc6a':'#cc0044';
    ctx.strokeStyle=col;ctx.lineWidth=1;
    ctx.beginPath();ctx.moveTo(x,toY(c.h));ctx.lineTo(x,toY(c.l));ctx.stroke();
    const bT=toY(Math.max(c.o,c.c)),bB=toY(Math.min(c.o,c.c));
    ctx.fillStyle=isUp?'rgba(0,204,106,0.85)':'rgba(204,0,68,0.85)';
    ctx.fillRect(x-cw/2,bT,cw,Math.max(1,bB-bT));
  });
  function drawLvl(p,col,lbl,dash=[4,3]){
    if(!p||isNaN(p)||p<mn||p>mx) return;
    const y=toY(p);
    ctx.strokeStyle=col;ctx.setLineDash(dash);ctx.lineWidth=1.2;
    ctx.beginPath();ctx.moveTo(LEFT,y);ctx.lineTo(W-RIGHT,y);ctx.stroke();ctx.setLineDash([]);
    const tw=ctx.measureText(lbl).width;
    ctx.fillStyle=col;ctx.fillRect(W-RIGHT-tw-10,y-8,tw+10,15);
    ctx.fillStyle='#000';ctx.font='bold 8px monospace';ctx.fillText(lbl,W-RIGHT-tw-6,y+3);
  }
  drawLvl(entry,'#00d4ff','ENTRY',[]);
  drawLvl(sl,'#ff3366','SL');
  drawLvl(tp1,'#00ff88','TP1');
  drawLvl(tp2,'rgba(0,200,100,0.7)','TP2',[5,4]);
  const st=STRATS[sid-1];
  ctx.fillStyle=st.color+'bb';ctx.font='bold 10px Syne,sans-serif';
  ctx.fillText(`S${sid}: ${st.short}`,LEFT+4,18);
}

// â”€â”€ MODAL â”€â”€
function openModal(id){
  const a=allAlerts.find(x=>x.id===id);
  if(!a) return;
  const short=a.sym.replace('USDT','');
  document.getElementById('mSym').textContent=short+'/USDT';
  document.getElementById('mDir').textContent=a.dir==='LONG'?'â–² LONG':'â–¼ SHORT';
  document.getElementById('mDir').className=`dbadge ${a.dir.toLowerCase()}`;
  document.getElementById('mStrat').textContent=`S${a.sid}: ${a.stratName}`;
  document.getElementById('mSub').textContent=`${a.tf} Â· Detected ${fmtT(a.time)} Â· Win Rate: ${a.winRate}% Â· R:R 1:${a.rr}`;
  document.getElementById('mEn').textContent='$'+a.entry;
  document.getElementById('mSL').textContent='$'+a.sl;
  document.getElementById('mRR').textContent='1:'+a.rr;
  document.getElementById('mWR').textContent=a.winRate+'%';
  document.getElementById('mLvls').innerHTML=`
    <div class="lvlcard en"><div class="ll">ENTRY</div><div class="lv">$${a.entry}</div></div>
    <div class="lvlcard sl"><div class="ll">STOP LOSS</div><div class="lv">$${a.sl}</div></div>
    <div class="lvlcard t1"><div class="ll">TP1</div><div class="lv">$${a.tp1}</div></div>
    <div class="lvlcard t2"><div class="ll">TP2</div><div class="lv">$${a.tp2}</div></div>
    <div class="lvlcard t3"><div class="ll">TP3 (ext)</div><div class="lv">$${a.tp3}</div></div>
    <div class="lvlcard rr"><div class="ll">R:R</div><div class="lv">1:${a.rr}</div></div>`;
  document.getElementById('eTitle').textContent=`S${a.sid}: ${STRATS[a.sid-1].name.toUpperCase()}`;
  document.getElementById('eTxt').textContent=a.explanation;
  document.getElementById('overlay').classList.add('open');
  // FIX 1: Wait for overlay transition + offsetWidth to be real, then draw
  setTimeout(()=>{
    drawModal(a.candles,a.dir,a.entryNum,a.slNum,a.tp1Num,a.tp2Num,a.sid,a.hlLevels||null,a.sweepLow||null);
  },200);
  newCount=0;document.getElementById('newBadge').textContent='0 NEW';
}
function closeOverlay(e){if(!e||e.target===document.getElementById('overlay'))document.getElementById('overlay').classList.remove('open');}

// â”€â”€ SOUND â”€â”€
function initAudio(){if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();}
function playSound(dir){
  if(!soundOn||!document.getElementById('sndTog')?.classList.contains('on')) return;
  try{
    initAudio();
    const freqs=dir==='LONG'?[392,523,659]:[659,523,392];
    freqs.forEach((f,i)=>{
      const o=audioCtx.createOscillator(),g=audioCtx.createGain();
      o.connect(g);g.connect(audioCtx.destination);
      o.frequency.value=f;o.type='sine';
      const t=audioCtx.currentTime+i*0.13;
      g.gain.setValueAtTime(0.12,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.28);
      o.start(t);o.stop(t+0.28);
    });
  }catch(e){}
}
function toggleSound(){
  soundOn=!soundOn;
  const btn=document.getElementById('sndBtn');
  btn.textContent=soundOn?'ğŸ”” Sound ON':'ğŸ”• Sound OFF';
  btn.classList.toggle('on',soundOn);
  document.getElementById('sndTog')?.classList.toggle('on',soundOn);
}
function syncSoundBtn(){
  const on=document.getElementById('sndTog')?.classList.contains('on');
  soundOn=on;
  const btn=document.getElementById('sndBtn');
  if(btn){btn.textContent=on?'ğŸ”” Sound ON':'ğŸ”• Sound OFF';btn.classList.toggle('on',on);}
}

// â”€â”€ PUSH + TOAST â”€â”€
async function reqPush(el){
  if('Notification' in window){
    const p=await Notification.requestPermission();
    el.classList.toggle('on',p==='granted');
    if(p==='granted') simpleToast('Push notifications enabled','âœ…');
  }
}
function pushNotif(a){
  if(!document.getElementById('pushTog')?.classList.contains('on')||Notification.permission!=='granted') return;
  new Notification(`${a.sym.replace('USDT','')} ${a.dir} â€” S${a.sid}`,{body:`${a.stratName} Â· ${a.tf} Â· Entry $${a.entry} Â· R:R 1:${a.rr}`,tag:a.id});
}
function showToast(a){
  if(!document.getElementById('toastTog')?.classList.contains('on')) return;
  const wrap=document.getElementById('toastWrap'),short=a.sym.replace('USDT','');
  const t=document.createElement('div');
  t.className=`toast ${a.dir.toLowerCase()}-t`;
  t.innerHTML=`<div class="tico">${a.dir==='LONG'?'ğŸŸ¢':'ğŸ”´'}</div><div><div class="ttitle">${short} ${a.dir} â€” S${a.sid}: ${a.stratName}</div><div class="tbody">${a.tf} Â· Entry $${a.entry} Â· R:R 1:${a.rr} Â· ${a.winRate}% WR</div><div class="ttime">${fmtT(a.time)}</div></div>`;
  t.onclick=()=>{openModal(a.id);showPage('alerts');};
  wrap.appendChild(t);
  setTimeout(()=>{t.classList.add('out');setTimeout(()=>t.remove(),260);},6000);
}
function simpleToast(msg,ico='â„¹ï¸'){
  const wrap=document.getElementById('toastWrap');
  const t=document.createElement('div');t.className='toast';
  t.innerHTML=`<div class="tico">${ico}</div><div><div class="ttitle">${msg}</div></div>`;
  wrap.appendChild(t);
  setTimeout(()=>{t.classList.add('out');setTimeout(()=>t.remove(),260);},3000);
}

// â”€â”€ STRATEGIES PAGE â”€â”€
function renderStrategies(){
  document.getElementById('stratsGrid').innerHTML=STRATS.map(s=>`
    <div class="sc">
      <div class="sch">
        <div class="snum" style="background:${s.color}18;border:1px solid ${s.color}40;color:${s.color}">S${s.id}</div>
        <div><div class="stitle">${s.name}</div><div class="stagline">${s.tags.join(' Â· ')}</div></div>
        <div class="wrbadge">${s.winRate}% WR</div>
      </div>
      <div class="scb">
        <div>
          <h5 style="font-family:var(--mono);font-size:9px;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-bottom:10px;">ENTRY CONDITIONS â€” ALL MUST BE MET</h5>
          <div class="cond-list">${s.conditions.map(c=>`<div class="cond-item">${c}</div>`).join('')}</div>
        </div>
        <div>
          <div class="tm-box"><div class="tm-lbl">Entry</div><div class="tm-val">${s.entry}</div></div>
          <div class="tm-box"><div class="tm-lbl" style="color:var(--red)">Stop Loss</div><div class="tm-val">${s.sl}</div></div>
          <div class="tm-box"><div class="tm-lbl" style="color:var(--green)">Take Profit</div><div class="tm-val">${s.tp}</div></div>
          <div class="s-desc">${s.desc}</div>
        </div>
      </div>
      <div class="sstats">
        <div class="ss"><div class="sv" style="color:${s.color}">${s.winRate}%</div><div class="sl">WIN RATE</div></div>
        <div class="ss"><div class="sv">1:${s.rrMin}â€“${s.rrMax}</div><div class="sl">R:R RANGE</div></div>
        <div class="ss"><div class="sv">15m/1H</div><div class="sl">TIMEFRAMES</div></div>
      </div>
    </div>`).join('');
}

// â”€â”€ SETTINGS â”€â”€
function renderSettingsToggles(){
  document.getElementById('stratToggles').innerHTML=STRATS.map(s=>`
    <div class="setr">
      <div><div class="setr-lbl">S${s.id}: ${s.short}</div><div class="setr-sub">${s.winRate}% WR Â· ${s.id===6?'Custom pattern':'ICT SMC'}</div></div>
      <div class="tog on" id="stog${s.id}" onclick="this.classList.toggle('on');stratEnabled[${s.id}]=this.classList.contains('on')"></div>
    </div>`).join('');
}

// FIX 2: saveSettings with prominent button feedback
function saveSettings(){
  const minRR=parseFloat(document.getElementById('minRRIn')?.value)||3;
  const scanM=parseInt(document.getElementById('scanMins')?.value)||5;
  try{localStorage.setItem('smc_minRR',minRR);localStorage.setItem('smc_scanMins',scanM);}catch(e){}
  cdSeconds=scanM*60; // apply immediately
  const btn=document.getElementById('mainSaveBtn'),st=document.getElementById('saveStatus');
  if(btn){btn.textContent='âœ“ SAVED!';btn.classList.add('saved');}
  if(st){st.textContent=`Saved â€” Min R:R: 1:${minRR} Â· Scan every ${scanM} min Â· Applied immediately`;}
  setTimeout(()=>{
    if(btn){btn.textContent='ğŸ’¾ SAVE SETTINGS';btn.classList.remove('saved');}
    if(st) st.textContent='';
  },3000);
  simpleToast(`Settings saved â€” Min R:R 1:${minRR} Â· Scan every ${scanM}min`,'ğŸ’¾');
}
function loadSavedSettings(){
  try{
    const rr=localStorage.getItem('smc_minRR'),sm=localStorage.getItem('smc_scanMins');
    if(rr){const el=document.getElementById('minRRIn');if(el)el.value=rr;}
    if(sm){const el=document.getElementById('scanMins');if(el)el.value=sm;}
  }catch(e){}
}

// â”€â”€ NAV â”€â”€
function showPage(name){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById(`page-${name}`).classList.add('active');
  document.querySelectorAll('.nav-btn').forEach(b=>{if(b.textContent.toLowerCase().startsWith(name.slice(0,4)))b.classList.add('active');});
}

// â”€â”€ DEMO ALERTS (use real-ish prices so they look valid) â”€â”€
function makeDemoAlert(sym,sid,dir,tf){
  const prices={'BTCUSDT':84500,'ETHUSDT':1950,'BNBUSDT':590,'SOLUSDT':135,'XRPUSDT':0.51,'DOGEUSDT':0.155,'ADAUSDT':0.68,'AVAXUSDT':21,'LINKUSDT':12.5,'DOTUSDT':3.8,'MATICUSDT':0.22,'LTCUSDT':78,'SHIBUSDT':0.0000135,'TRXUSDT':0.24,'ATOMUSDT':4.2,'UNIUSDT':5.8,'XLMUSDT':0.27,'ETCUSDT':16,'NEARUSDT':2.1,'AAVEUSDT':140};
  const base=prices[sym]||50;
  const A=base*0.016;
  const price=base*(0.997+Math.random()*0.006);
  const entry=dir==='LONG'?price*0.998:price*1.002;
  const sl=dir==='LONG'?entry-A*1.3:entry+A*1.3;
  const rrV=3+Math.random()*4;
  const tp1=dir==='LONG'?entry+(entry-sl)*rrV:entry-(sl-entry)*rrV;
  const tp2=dir==='LONG'?entry+(entry-sl)*(rrV+2):entry-(sl-entry)*(rrV+2);
  const candles=[];let p=price*0.97;
  for(let i=0;i<65;i++){
    const mv=(Math.random()-0.48)*A*0.7;
    const h=p+Math.abs(mv)+Math.random()*A*0.25,l=p-Math.abs(mv)-Math.random()*A*0.25;
    candles.push({t:Date.now()-(65-i)*60000,o:p,h,l,c:p+mv,v:Math.random()*800000});
    p=p+mv;
  }
  return makeAlert(sym,tf,sid,dir,price,entry,sl,tp1,tp2,rrV,candles,50);
}

function loadDemos(){
  const demos=[['BTCUSDT',3,'LONG','1h'],['ETHUSDT',2,'SHORT','15m'],['SOLUSDT',6,'LONG','1h'],['BNBUSDT',1,'LONG','15m'],['XRPUSDT',5,'LONG','1h'],['AVAXUSDT',4,'SHORT','15m'],['LINKUSDT',3,'SHORT','1h'],['ADAUSDT',6,'LONG','15m'],['DOGEUSDT',1,'SHORT','15m'],['DOTUSDT',5,'LONG','1h']];
  demos.forEach((d,i)=>{
    setTimeout(()=>{
      const a=makeDemoAlert(...d);
      if(a.sid===6){a.hlLevels=[a.entryNum*0.985,a.entryNum*0.99,a.entryNum*0.995];a.sweepLow=a.entryNum*0.982;}
      allAlerts.unshift(a);
      if(i<3){showToast(a);if(i===0)playSound(d[2]);}
      renderAlerts();updateStats();
    },i*250);
  });
}

// â”€â”€ INIT â”€â”€
async function init(){
  loadSavedSettings();
  renderStrategies();
  renderSettingsToggles();
  loadDemos();
  document.addEventListener('keydown',e=>{
    if(e.key==='Escape') document.getElementById('overlay').classList.remove('open');
    if(e.key==='1') showPage('alerts');
    if(e.key==='2') showPage('strategies');
    if(e.key==='3') showPage('settings');
  });
  setInterval(tickCountdown,1000);
  setTimeout(runScan,1200);
  setInterval(()=>{if(cdSeconds<=0&&document.getElementById('autoTog')?.classList.contains('on'))runScan();else if(cdSeconds<=0)resetCountdown();},1000);
  setInterval(async()=>{await fetchAllTickers();renderWatchlist();},20000);
  if('wakeLock' in navigator){try{await navigator.wakeLock.request('screen');}catch(e){}}
  simpleToast('SMC Scanner active â€” 60 pairs Â· 15m + 1H Â· 6 strategies','âš¡');
}

document.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>
